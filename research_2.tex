\documentclass[12pt]{report}
\usepackage{geometry}	
\usepackage{cite}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{multicol}
\usepackage{titlesec}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{textcomp}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{comment}
\usepackage{etoolbox}
\usepackage{anyfontsize}
\usepackage{url}
\usepackage{multirow}
\usepackage{array}
\usepackage{tabu}
\usepackage{hyperref}
\usepackage{color}
\usepackage{epigraph}
\usepackage{makebox}
\usepackage{graphicx}
\usepackage{array}
\usepackage{setspace}
\usepackage[english]{babel}


\renewcommand{\arraystretch}{2}
\renewcommand{\bibname}{REFERENCES}
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    %linkcolor=[RGB]{0,204,0},
    linkcolor=black,
    urlcolor=black
}
% \captionsetup[figure]{labelfont=bf, font=footnotesize}

\setlength{\parskip}{1em}
% \setcounter{tocdepth}{4} 
% \setcounter{secnumdepth}{4}

%this several lines is for: no number before suction. (This is a bug)
\makeatletter
\patchcmd{\ttlh@hang}{\parindent\z@}{\parindent\z@\leavevmode}{}{}
\patchcmd{\ttlh@hang}{\noindent}{}{}{}
\makeatother


\geometry{
	a4paper,
	% total={210mm,297mm},
 	left=35mm,
 	top=25mm,
 	right=35mm,
}

\title{\textbf{Broadband Spectra Analysis of Three Energetic Millisecond Pulsars}\\ \vspace{1cm}
			{\large Department of Physics, The University of Hong Kong, Pokfulam Road, Hong Kong}\\ \vspace{1cm}
			% {\includegraphics[scale=0.2]{{/Users/grewwc/Desktop/Thesis/hku.png}}}\\ \vspace{3cm}
}
\date{}
\author{Wang Wenchao  \\3030053350}
\setlength{\columnsep}{1cm}

% \titleformat
% {\chapter} % command
% [display] % shape
% {\bfseries\Large} % format
% {\textit{Chapter \thechapter}} % label
% {0.5ex} % sep
% {
%     \rule{\textwidth}{1pt}
%     \vspace{1ex}
%     \centering
% } % before-code

% \titleformat{\section}[hang]
% {\large\bfseries}
% {\thesection}
% {0.5em}
% {}

% \titleformat{\subsection}[hang]
% {\fontsize{12}{15}\bfseries\sffamily}
% {\thesubsection}
% {1em}
% {}

% \titleformat{\subsubsection}[hang]
% {\fontsize{11}{15}\bfseries\sffamily}
% {\thesubsection}
% {0.5em}
% {}

% \titleformat{\subsubsubsection}[hang]
% {\fontsize{9}{15}\bfseries\sffamily}
% {\thesubsection}
% {0.5em}
% {}

\newcommand{\mycaption}[1]{\protect \caption{#1}}
%Below is the main content.

%insert a single figure.
%parameters: 
%%  1. path
%%  2. scale
%%  3. caption
\newcommand{\singleFig}[3]{
  \begin{figure}[!ht]
    \centering
    \includegraphics[scale=#2]{/Users/grewwc/Desktop/Thesis/#1}
    \caption{#3}
    \label{fig: #1}
  \end{figure}
}

\newcommand{\gj}[0]{
  Goldreich-Julian charge density
}

\newcommand{\fgl}[0]{
  \textit{Fermi LAT 4-year Point Source Catalog}
}

\newcommand{\question}[1]{
  $<$\textbf{question}$>$#1$<$\textbf{/question}$>$
}

\newcommand{\change}[1]{
  $<$\colorbox{red}{\textbf{change}}$>$#1$<$\colorbox{red}{\textbf{/change}}$>$
}

\newcommand{\add}[1]{
  $<$\colorbox{red}{\textbf{add}}$>$#1$<$\colorbox{red}{\textbf{/add}}$>$
}

\newcommand{\mayAdd}[1]{
  $<$\colorbox{red}{\textbf{mayAdd}}$>$#1$<$\colorbox{red}{\textbf{/mayAdd}}$>$
}


\newcommand{\mayChange}[1]{
  $<$\colorbox{red}{\textbf{mayChange}}$>$#1$<$\colorbox{red}{\textbf{/mayChange}}$>$
}

\newcommand{\myComment}[1]{
  %#1 
  \newline
}

\newcommand{\Notice}[1]{
  $<$\textbf{Notice}$>$#1$<$\textbf{/Notice}$>$
}

\newcommand{\blackhref}[2]{
  \href{#1}{\color{black}{\textit{\small #2}}}
}



\begin{document}
\maketitle

\pagenumbering{roman}


% \thispagestyle{empty}
\cleardoublepage
\addcontentsline{toc}{chapter}{Acknowledgements}
\chapter*{Acknowledgements}
  This is acknowledgement. 
  

\cleardoublepage
\addcontentsline{toc}{chapter}{Abstract}
\chapter*{Abstract}
  \doublespacing
  In the thesis, I mainly introduce our study on the high energy spectra of three 
  millisecond pulsars which are PSR J0218+4232, PSR B1821-24 and PSR B1937+21. 
  The \textit{Fermi LAT} Pass 8 data was published in 2015 and has lots of advantages over 
  the old Pass 7 data, such as increased effective area and wider energy range. Since 
  the recent gamma-ray spectra analysis of the three MSPs are relatively old (in about 2014), 
  I redo the gamma-ray spectra analysis of the MSPs with 
  4-year more \textit{Fermi LAT} observation data and newly published Pass 8 data. 
  As expected, I obtain better fit results for gamma-ray spectra of 
  the three MSPs with smaller errors and larger test statistic values. Then I briefly 
  introduce a pulsar emission model called two-layer model \cite{0004-637X-787-2-167} and 
  do numerical simulation to test the two-layer model using the new observation data.
  By minimizing the differences between the predictions of the two-layer model and the real 
  data, I fit the independent parameters of the two-layer model, which is helpful to
  understand emission mechanisms of pulsars. I find that though the two-layer model is 
  simple, it can generate broad-band spectra of pulsars which are very close to the 
  observation data from \textit{Fermi LAT} in most energy bands.
			
\cleardoublepage
\addcontentsline{toc}{chapter}{\listfigurename}
\newpage

\cleardoublepage
\addcontentsline{toc}{chapter}{\listtablename}

\tableofcontents

\pagenumbering{arabic}

\listoffigures

\listoftables


\chapter{Introduction}   	   
  \section{Neutron Stars and Pulsars}
    Neutron stars are produced by supernovae explosion of massive stars which have about four 
    to eight solar mass. After a supernova explosion, a star leaves a central region. 
    And the central region collapses because of the effect of 
    gravity until protons and electrons combine to form neutrons 
    ($e^{-}+p\rightarrow n+\nu_{e}$) ---the reason why they are called ``neutron stars''.  
    Because neutrons have no electromagnetic force on each other, they can be squeezed very 
    tightly. Therefore, a neutron star has tremendous high density 
    (about $5\times 10^{17} \mbox{kg/m}^3$) and its diameter and mass is about20km and 
    1.4 solar mass respectively. What
    prevents a neutron star to continue to contract is the degeneracy pressure of neutrons. 
    
    Pulsars are fast-spinning neutron stars. They have rotational periods from a few 
    milliseconds to several seconds. For example, the rotational period of PSR B1937+21 is 
    about 1.56ms while PSR B1919+21 is approximately 1.34s. As we know, a star can be ripped 
    by centrifugal force if the star rotates too fast. We can estimate lower limit of 
    density of a star with the equation $\rho=\frac{3\pi}{P^2G}$, where $P$ is the 
    rotational period of a pulsar. Just for simplicity, let $P$ be 1s. Then we 
    get $\rho\approx 1.4\times 10^{11}\mbox{kg/m}^3$. With the knowledge that the 
    density of a white dwarf is about $1\times 10^9\mbox{kg/m}^3$ which is smaller than 
    the lower density limit, the observed fast-spinning stars belong to the kind of stars 
    which are much denser than white dwarf. As a result, neutron stars are ideal candidates 
    for pulsars. 
    
    More than 2000 pulsars have been discovered so far. Most of them are in the disk of 
    our Galaxy while we also can find a small portion of them in high latitude, which can be 
    seen clearly in Figure \ref{fig: spatial_distribution}. This may 
    because they cannot escape the gravitational potential if their kinetic energy is not 
    large enough. Besides, even though they have large enough velocities to escape from their 
    birth region, there are some probabilities that they become nearly non-detectable before 
    reaching high latitude. 

    \begin{figure}[h]
      \centering
      \includegraphics[scale=0.35]{/Users/grewwc/Desktop/Thesis/pulsar_distribution.png}
      \caption{Spatial distribution of some pulsars in galactic coordinate system.}
      \label{fig: spatial_distribution}
    \end{figure}
    
    \section{Emission Mechanism of Pulsars}
      Although the emission mechanism of pulsars has not been fully understood yet, some 
      models have been developed 
      trying to explain observational data. The following is a simple model that can explain 
      some basic features of pulsars spectra. I will first introduce the magnetic dipole model, 
      then the synchrotron radiation and inverse Compton radiation. 
      
      \subsection{Magnetic Dipole Model}
        Assuming a pulsar has a magnetic dipole moment $\vec{m}$, the angel between rotation axis and 
        direction of 
        $\vec{m}$ is $\alpha$, its angular velocity is $\Omega$, radius is R and moment of inertia is $I$. 
        Also assuming that energy of electromagnetic radiation is completely from the rotational energy, 
        its spin-down rate can be written as: 
        $$
            \dot{\Omega}=-\frac{B_p^2 R^6 \Omega^3 \sin{\alpha}^3}{6c^3I}
        $$
        where $B_p$ is magnetic field strength in the pole of the pulsar. Its surface magnetic field can 
        also be estimated by:
        $$
            B_s=\sqrt{\frac{3c^3I}{2\pi^2R^6}P\dot{P}}=3.2\times 10^{19}\sqrt{P\dot{P}}
        $$
        where $B_s$ is the strength of surface magnetic field. \\
        \indent In general, a pulsar's spin down rate can be expressed as: $\dot{\Omega}=-K\Omega^{n}$, 
        where K is a constant and n is called braking index. In magnetic dipole model n is 
        3 \cite{Tong2015}. Then characteristic age of the pulsar can be defined as: 
        $P/2\dot{P}$ in magnetic dipole model. For example, the Crab 
        pulsar's rotation period is about $0.033s$ and period derivative is 
        $4.22\times 10^{-13}s/s$. The characteristic age is about 1200 years. The pulsar 
        is remnant of a supernova which is observed by ancient astronomers in 1054 
        AD, so the record shows that characteristic age can give us and an order of magnetic 
        estimate of a pulsar's real age. \\
        \indent 
        Although the braking index is 3 in magnetic dipole model, most of pulsars' braking 
        index is less than 3 as shown in Figure \ref{fig:braking_index}. The reason is that if
        a pulsar's spin down is completely because of pulsar wind, the braking index is 1. 
        Thus, the real braking index should be a combination of 1 and 3, which is usually 
        less than 3. \cite{PhysRevD.91.063007}
        
        \begin{figure}[!ht]
          \centering
          \includegraphics[scale=0.6]{/Users/grewwc/Desktop/Thesis/table.png}
          \caption{Braking index of some pulsars.}
          \label{fig:braking_index}
        \end{figure}
    
        \subsection{Synchrotron Radiation}
          Synchrotron radiation is a special case of cyclotron radiation when a particle's
          speed is comparable to the speed of light. Because of the relativistic beaming 
          effect, we will observe a very short radiation pulse when speed of particles is 
          large. We only aim to analyze the spectral properties of MSPs, so we focus on the 
          spectrum property of synchrotron radiation. 
          With Larmor's Formula we can derive the synchrotron radiation power of an electron:
          \begin{equation}
            \label{func: sync_total_power_precise}
            P = \frac{2e^4\gamma^2\beta^2B_{\perp}^2}{3m_e^2c^3} 
          \end{equation}
          where $\gamma$ is the Lorentz factor of the electron, $\beta=v/c$ and $B_{\perp}$ 
          is the strength of magnetic field perpendicular to the circular motion plane. 
          When $\beta \sim 1$, Function \ref{func: sync_total_power_precise} can be 
          simplified as:
          \begin{equation}
            \label{func: sync_total_power_simplified}
            P = \frac{2}{3}\frac{e^2c}{R^2}\gamma^4
          \end{equation}
          where $R = E / e B_{\perp}$ is the radius of the electron's circular motion. 
          Furthermore, the power spectrum of a single electron  
          can be described by Function \ref{func: syncrothron spectrum}
          \begin{eqnarray}
          \label{func: syncrothron spectrum}
            P\left(\nu\right) &=& \frac{\sqrt{3} e^3 B \sin{\alpha}}{m c^2} 
              \left(\frac{\nu}{\nu_c}\right) \int_{\nu / \nu_c}^{\infty} K_{5/3}\left(\eta \right)d\eta  \nonumber \\
              &=& \frac{\sqrt{3}e^2}{m_eR}\gamma \left(\frac{\nu}{\nu_c}\right) \int_{\nu / \nu_c}^{\infty} K_{5/3}\left(\eta \right)d\eta
          \end{eqnarray}
          where $\nu_c$ is the critical frequency and $K_{5/3}$ is modified Bessel function. 
          The critical frequency can be expressed by Function \ref{func: critical_frequency}
          \begin{eqnarray}
            \label{func: critical_frequency}
            \nu_c &=& \frac{3}{2} \gamma^2 \nu_{cyc} \sin{\alpha} \nonumber \\
                  &=& \frac{3}{4\pi} \frac{c}{R} \gamma^3 
          \end{eqnarray} 
          where $\alpha$ is the pitch angle and the $\nu_{cyc}$ is the frequency of 
          corresponding cyclotron radiation. These functions do not give us very much 
          information because of the integration of the modified Bessel function. We let 
          $x = \nu / \nu_c$ and fix the environment variables such as magnetic field ($B$), 
          Function \ref{func: syncrothron spectrum} becomes: 
          \begin{equation}
            \label{func: to_x}
            P\left(\nu\right) = C \times x \int_{x}^{\infty} K_{5/3}\left(\eta \right)d\eta 
          \end{equation}
          where $C$ is a constant dependent on $B$. Thus, in order to analyze the power spectrum of synchrotron radiation,
          we only concentrate on the later part, which is
          \begin{equation}
            \label{func: fx}
            F\left(x\right) = x \int_{x}^{\infty} K_{5/3}\left(\eta \right)d\eta 
          \end{equation}
            
            % \begin{figure}[!ht] 
            % \begin{minipage}{\textwidth}
            %   \begin{center} 
            %     \includegraphics[scale=0.6]{/Users/grewwc/Desktop/Thesis/sync_spectrum_loglog.png}
            %   \end{center}
            %   \end{minipage}
            %   \\
            % \begin{minipage}{\textwidth}
            %   \begin{center}
            %   \includegraphics[scale=0.61]{/Users/grewwc/Desktop/Thesis/sync_power_loglog.png}
            %   \end{center}
            % \end{minipage}
            % \centering
            %   \mycaption{According to Function \ref{func: fx}, top: $F\left(x\right)$; bottom: $x F\left(x\right)$.
            %     \change{should change the style of .}}
            %   \label{fig: sync_spectrum_loglog}
            % \end{figure}
            
            \singleFig{sync_spectrum_loglog_combined}{0.5}{Spectrum shape of synchrotron 
            radiation for a single particle (top). According ot Eq. \ref{func: fx},
            The top figure \ref{func: fx} describes the general shape of power spectrum of 
            synchrotron radiation. When the frequency is larger than
            the critical frequency $\nu_c$, the power goes down dramatically. However, the 
            top figure does not show the information that at what frequency the charged 
            particle emit the strongest power, which can be described in the bottom figure. 
            The bottom figure reveals that most energy is emitted around critical frequency.}
  
            In reality, synchrotron radiation is not generated by a single particle. We 
            describe the number density distribution of electrons with respect to energy by a 
            single power-law model:
            \begin{equation}
              \label{func: sync_number_density}
              N\left(E\right) \approx C E^{-\delta}
            \end{equation}
          
            For simplicity, we set the ambient magnetic field $B$ to be a constant and make an 
            approximation that all radiations are at a single frequency:
            \begin{equation}
              \label{func: sync_approximation}
              \nu \approx \gamma^2 \nu_{cyc}
            \end{equation}
            where the meaning of $\nu_{cyc}$ is the same as Function 
            \ref{func: critical_frequency}. Our objective is to know the relationship between 
            total power of all electrons and their radiation frequency. We describe the 
            relationship as Eq. \ref{func: sync_power_single_frequency}
            
            \begin{eqnarray}
              \label{func: sync_power_single_frequency}
              -P\left(E\right)N\left(E\right)dE &=& Q_{\nu} d\nu\\
              P\left(E\right) &=& \frac{4}{3} \sigma_{T} \beta^2 \gamma^2 c U_B
            \end{eqnarray} 
            where $\sigma_{T}$ is electron Thompson scattering section, $U_B$ is energy 
            density of the environment magnetic field,  $Q_{nu}$ is the emission coefficient 
            of synchrotron radiation and $E=\gamma m_e c^2$. With Eq. 
            \ref{func: sync_approximation}, we have
            \begin{equation}
              \label{func: sync_combine}
              P = \frac{dE}{d\nu} = \frac{m_e c^2}{2\sqrt{\nu \nu_{cyc}}}
            \end{equation}
            Combine Functions \ref{func: sync_combine} and 
            \ref{func: sync_power_single_frequency} we get:
            \begin{equation}
              Q_{\nu} = \frac{4}{3} \sigma_{T} \beta^2 \gamma^2 c U_B \frac{m_e c^2}{2\sqrt{\nu \nu_{cyc}}} N\left(E\right)
            \end{equation}
            Ignoring constants in Function \ref{func: sync_power_single_frequency} we have 
            \begin{equation}
              \label{func: sync_final}
              Q_{\nu} \propto \nu^{(1-\delta)/2}
            \end{equation}
            Function \ref{func: sync_final} shows that if the number density electrons is 
            a power-law distribution, the spectrum of synchrotron radiation is also a 
            power-lay model.  
            
          \subsection{Inverse-Compton radiation}
            If an energetic relativistic photon collides with a charged particle from an 
            proper incident angle, the photon's energy decreases and its direction changes. 
            This is the process of Compton Scattering. Inverse-Compton radiation is the 
            opposite process and a low energy photon gained energy from an ultra-relativistic 
            electron in the process. 

            \singleFig{inverse_compton}{0.45}{Inverse Compton Diagram}
            As Figure \ref{fig: inverse_compton} shows, in the laboratory frame ($S$), the 
            incident angle and energy of a photon is $\theta$ and $h \nu$ respectively. 
            The speed of the electron is $v$. In the electron rest frame ($S^{\prime}$), 
            we change the denotation to $\theta^{\prime}$, $h \nu^{\prime}$ and. Also, let 
            the position of the electron be the origin point of $S^{\prime}$. We can study 
            the whole process in the $S^{\prime}$ frame, the transfer the result to the $S$ 
            frame by Lorentz transformation. 

            In the $S^{\prime}$ frame, the electron is at rest so its energy is $m_e c^2$. 
            For Inverse Compton scattering, the energy of an incident photon 
            (less than several $keV$) is much less than the rest energy of an electron 
            (about $0.51MeV$) and the relationship can be expressed by 
            $h\nu^{\prime} \ll m_e c^2$. Therefore, this can be treated as Thompson 
            Scattering process. Let the Poynting vector of incident photons be 
            $\vec{S}^{\prime}$ and their energy density be $U_{rad}^{\prime}$, we have 
            equation \ref{eq: poynting_and_energy_density}
            \begin{equation}
              \label{eq: poynting_and_energy_density}
              \vec{S}^{\prime} = c U_{rad}^{\prime}
            \end{equation}
            The electron absorbs the energy of the incident photons and then be accelerated. 
            Thus the accelerated electron will emit part of the energy taken from incoming 
            photons and the power of scattered radiation is denoted as $P^{\prime}$.
            The ratio can be described by Thompson Scattering cross section $\sigma_{T}$ 
            which is:
            \begin{equation}
              \label{eq: thompson_cross_section}
              \sigma_{T} = \frac{8\pi}{3} \left(\frac{e^2}{m_e c^2}\right)^2
            \end{equation}
            and the relationship between the electron radiation power and incoming photon 
            energy flux can be described by Eq. \ref{eq: relationship_power_poynting}
            \begin{equation}
              \label{eq: relationship_power_poynting}
              P^{\prime} = \left| \vec{S}^{\prime} \right| \sigma_{T}
            \end{equation}
            Combine Eqs. \ref{eq: poynting_and_energy_density} and 
            \ref{eq: relationship_power_poynting}, the radiation power emitted by the 
            electron is: 
            \begin{equation}
              \label{eq: final_relationship}
              P^{\prime} = c \sigma_{T} U^{\prime}_{rad}
            \end{equation}

            Then we need to find the relationship between frames $S$ and $S^{\prime}$. 
            It mainly contains two parts: the relationship between $P$, $P^{\prime}$ and 
            $U_{rad}$, $U_{rad}^{\prime}$. Since $P = dE/dt$ and $dE/dt$ is Lorentz invariant 
            in inertial frame, we get the equation: 
            \begin{equation}
              \label{eq: power_is_equal}
              P = P^{\prime}
            \end{equation}
            Now we hope to write $U_{rad}^{\prime}$ in terms of $U_{rad}$. $U_{rad}$ is 
            comprised by energy of a single photon and photon density. In the following
            analysis, all the denotations are correspondent to Eq. \ref{fig: inverse_compton}. 
            According to the relativistic Doppler shift formula, we have: 
            \begin{equation}
              \label{eq: doppler_shift}
              h \nu^{\prime} = \left(h \nu\right) \gamma \left(1 + \beta \cos{\theta} \right)
            \end{equation}
            where $\beta = v / c$ and $\gamma$ is Lorentz factor of an ultra-relativistic 
            electron. Then we calculate the photon density. In the frame $S^{\prime}$, the 
            photon density is inverse proportional to the time interval ($\Delta t$) between 
            the two photons striking the electron since total number of photons is Lorentz 
            invariant. In laboratory frame $S$, we consider two photons collide with the 
            electron at the 4-dimension vector of 
            $\left(x_{1}, 0, 0, t_{1}\right)$ and $\left(x_{2}, 0, 0, t_{2}\right)$. 
            According to the Lorentz transformation between inertial frames: 
            \begin{equation}
              \label{eq: lorentz_transfer_general}
                \begin{cases}
                  & x = \gamma \left( x^{\prime} + \beta c t^{\prime} \right)\\
                  & y = y^{\prime} \\
                  & z = z^{\prime} \\ 
                  & t = \gamma \left(t^{\prime} + \frac{\beta x^{\prime}}{c}\right)
                \end{cases}       
            \end{equation}
            and because we set $x^{\prime} = 0$, from Eq. \ref{eq: lorentz_transfer_general}, 
            the two events of two successive photons collide with the electron can be 
            expressed as:
            $\left(\gamma v t_{1}^{\prime}, 0, 0, \gamma t_{1}^{\prime}\right)$ and 
            $\left(\gamma v t_{2}^{\prime}, 0, 0, \gamma t_{2}^{\prime}\right)$. 
            As Figure \ref{fig: inverse_compton_time_interval} shows, the time interval of two 
            successive photons (reciprocal of frequency) in frame $S$ is: 
            \begin{eqnarray}
              \label{eq: inverse_compton_time_interval}
              \Delta t &=& \left(t_2 - t_1\right) + \frac{\left(x_2 - x_1\right) \cos{\theta}}{c}  \nonumber \\
                      &=& \gamma \left(t_{2}^{\prime} - t_{1}^{\prime}\right) + \frac{\gamma v \left(t_{2}^{\prime} - t_{1}^{\prime}\right) \cos{\theta}}{c} \nonumber \\
                      &=&  \Delta t^{\prime} \gamma \left(1 + \beta \cos{\theta}\right) 
            \end{eqnarray}
            Eq. \ref{eq: inverse_compton_time_interval} shows that the relationship of photon 
            number density between frame $S$ and $S^{\prime}$ is:
            \begin{equation}
              \label{eq: inverse_compton_number_density_relationship}
              n^{\prime} = n \gamma \left(1 + \beta \cos{\theta}\right) 
            \end{equation}
            Combine Eqs. \ref{eq: inverse_compton_number_density_relationship} and 
            \ref{eq: doppler_shift} we can transfer the incident photon energy density from 
            frame $S$ to $S^{\prime}$ according to Eq. \ref{eq: inverse_compton_energy_density}
            \begin{equation}
              \label{eq: inverse_compton_energy_density}
              U_{rad}^{\prime} = U_{rad} \left[\gamma \left(1 + \beta \cos{\theta}\right)\right]^{2}
            \end{equation}
            In Eq. \ref{eq: inverse_compton_energy_density}, the incoming photon energy density 
            is a function of the incident angle ($\theta$), in order to get the total photon 
            energy density, we integrate the equation over $\theta$. Then we get: 
            \begin{equation}
              \label{eq: inverse_compton_energy_density_total}
              U_{rad}^{\prime} = \frac{4}{3} U_{rad} \left(\gamma^2 - \frac{1}{4}\right)
            \end{equation}
            Combine Eqs. \ref{eq: inverse_compton_energy_density_total} and 
            \ref{eq: final_relationship}, the total scattered radiation power is:
            \begin{eqnarray}
              \label{eq: inverse_compton_power}
              P^{\prime} &=& P  \nonumber \\
                        &=& \frac{4}{3} \sigma_{T} c U_{rad} \left(\gamma^2 - \frac{1}{4}\right)
            \end{eqnarray}
            As mentioned before, $P^{\prime}$ and $P$ are the total radiation powers after 
            scattering. Before the 
            low energy gain photons, they give away some energy first which is $\sigma_{T} c U_{rad}$. 
            Therefore, we have to subtract this value from Eq. \ref{eq: inverse_compton_power} 
            to calculate the rate of net energy gain, which is described by Eq. 
            \ref{eq: inverse_compton_net_gain}.
            \begin{eqnarray}
              \label{eq: inverse_compton_net_gain}
              P^{\prime} = P = \frac{dE}{dt} &=& \frac{4}{3} \sigma_{T} c U_{rad} \left(\gamma^2 - \frac{1}{4}\right) - \sigma_{T} c U_{rad} \nonumber \\
                                            &=& \frac{4}{3} \sigma_{T} c U_{rad} \beta^{2} \gamma^{2}
            \end{eqnarray}
            If we compare Eq. \ref{eq: inverse_compton_net_gain} with 
            Eq. \ref{func: sync_combine}, we find that the form is very similar between these 
            two equations. 
            \begin{equation}
              \label{eq: comparision_inverse_compton_and_sync}
              \frac{P_{IC}}{P_{sync}} = \frac{U_{rad}}{U_{B}}
            \end{equation}
            where $U_{B}$ is the energy density of environment magnetic field. 

            \vspace{1cm}
            \singleFig{inverse_compton_time_interval}{0.45}{Two photons collide with an 
              electron. In the frame $S^{\prime}$, two photons collide with a rest electron 
              successively. In the frame $S$, the electron is no longer at rest and the 
              positions of the two events are $x_1$ and $x_2$}
          % \add{spectrum property, shape}
        
        \subsection{Curvature Radiation}
          Curvature radiation is the main source of gamma-ray photons. Charged particles  
          not only move around magnetic field lines (synchrotron radiation), 
          but also along magnetic field lines (curvature radiation) because the magnetic 
          field is very strong.

          Eq. \ref{func: sync_total_power_precise} shows that total synchrotron radiation 
          power is related to pitch angel (because of the term $B_\perp$), and if the 
          pitch angel is $0$, there will be no synchrotron radiation. However, curvature 
          radiation can still be generated and is dependent on the curvature radii of 
          magnetic field lines:
          \begin{equation}
            \label{func: curvature_radiation}
            P = \frac{2}{3}\frac{e^2c}{s^2}\gamma^4
          \end{equation}
          where $s$ is the curvature radii of magnetic field lines. 
          Eq. \ref{func: curvature_radiation} is very similar to the Eq. 
          \ref{func: sync_total_power_simplified} and the only difference is that 
          $R$ is changed to $s$. Similarly, according to the Eq. 
          \ref{func: syncrothron spectrum}, the power spectrum of curvature radiation can 
          be written as:
          \begin{equation}
            \label{func: curvature spectrum}
            P = \frac{\sqrt{3}e^2}{m_es}\gamma \left(\frac{\nu}{\nu_c}\right) \int_{\nu / \nu_c}^{\infty} K_{5/3}\left(\eta \right)d\eta
          \end{equation}
          where $\nu_c$ is the critical frequencies of curvature photons and equals to:
          \begin{equation}
            \label{func: curvature critical frequency}
            \nu_c = \frac{3}{4\pi}\frac{c}{s}\gamma^3
          \end{equation}
          According to Eqs. \ref{func: curvature_radiation}, \ref{func: curvature spectrum} 
          and \ref{func: curvature critical frequency}, the spectral properties of curvature 
          radiation are similar to synchrotron radiation. The only differences in the 
          equations are particles' Lorentz factors and curvature radii. 

        

      \section{Millisecond Pulsar} 
        \subsection{$\mbox{P}$-$\dot{\mbox{P}}$ Diagram} 
          $P$-$\dot{\mbox{P}}$ diagram is an important tool for analyzing evolutions of 
          pulsars. Period ($\mbox{P}$) and time derivative of period ($\dot{\mbox{P}}$) are 
          two of pulsars' important characteristics. Analyzing the position of a pulsar in 
          the $P$-$\dot{\mbox{P}}$ diagram can give us some valuable information such as 
          which evolution stage the pulsar is in or the type of the pulsar, etc. 
          Figure \ref{fig:p-pdot} is an example of a $P$-$\dot{\mbox{P}}$ diagram. 
          The horizontal axis is pulsars' rotation periods and the vertical axis is time 
          derivative of rotation periods ($\dot{\mbox{P}}$).
          \begin{figure}[h]
              \centering
              \includegraphics[scale=0.55]{/Users/grewwc/Desktop/Thesis/ppdot.png}
              \caption{\protect Position of pulsars in $\mbox{P}$-$\dot{\mbox{P}}$ diagram}
              \label{fig:p-pdot}
          \end{figure}
          In this $P$-$\dot{\mbox{P}}$ diagram, the negative slope lines represent the strengths 
          of surface magnetic fields while the positive slope lines represent the characteristic 
          ages of pulsars. The following is a short explanation for this. 
          From previous discussion, we have known that the 
          characteristic age of a pulsar is $\tau=-P/\dot{P}=P/(-\dot{P})$, so line of constant 
          $\tau$ is a set of straight lines with equal positive slope. We also know 
          $B\propto\sqrt{P\dot{P}}$, therefore the line of constant $B$ should be a part 
          of hyperbola. However, a $\mbox{P}$-$\dot{\mbox{P}}$ diagram is usually in log-log 
          scale. Hence, if we let $P^{\prime}=\log{P}$ and $\dot{P}^{\prime}=\log{\dot{P}}$,
          $B\propto\sqrt{P\dot{P}}$ turns to 
          $B\propto 1/2 \left(P^{\prime} + \dot{P}^{\prime}\right)$, 
          which represents a straight line.

          Figure \ref{fig:p-pdot} shows that most pulsars lie in the position of about 
          $1$s, $10^{-14}$s/s. At the same time, a couple of stars lie at the bottom-left 
          of Figure \ref{fig:p-pdot} --- these are millisecond pulsars (MSPs). Their 
          rotation periods are about 1-20 milliseconds. It is believed that MSPs are spun 
          up by accretion of mass from their companion stars. In the above 
          $P$-$\dot{\mbox{P}}$ diagram, we can observe that millisecond pulsars' 
          surface magnetic fields are about three to four orders of magnitude lower than those
          of normal pulsars. However, an MSP has a relative strong magnetic field near its 
          light cylinder. The reason is that an MSP's radius 
          of light cylinder ($R_{lc}=c/\omega)$ is much smaller than a normal pulsar's 
          because of its short rotation period and the magnetic field near light cylinder can
          be estimated as $B_{lc}\sim\left(R/R_{lc}\right)^3$. At the same time, 
          pulsars' emission mechanism is closely related to their magnetic field near the light 
          cylinder. As a result, like a normal pulsar, an MSP also can have broadband spectrum 
          from radio to gamma rays. 
          \subsection{Origin Of Millisecond Pulsars}
            From pulsars' emission mechanisms, we know that magnetic field of a pulsar 
            decreases with time while the spin period increase with time. But MSPs' spin 
            periods are much shorter than normal pulsars and surface magnetic fields are a 
            lot weaker. This makes an MSP seem to be both young and old. As a result,
            people think millisecond pulsars are old pulsars spun up by their companions. 
            The companion stars transfer mass and angular momentum to accelerate the rotation
            speed of pulsar. Therefore, the aged pulsar can spin faster gradually. 
            \subsubsection{Mass Transfer And Accretion In Binary Systems}
              X-ray binaries are a type of binary systems that is luminous in X-ray band. 
              There are several kinds of X-ray binaries including low mass X-ray binaries 
              (LMXB) and high mass X-ray binaries (HMXB). The mechanism of transferring mass 
              is different in these two types of systems. Before discussing mass 
              transfer, we need to know a little bit about Roche Lobe. Figure 
              \ref{fig:roche lobe} is a schematic diagram of Roche Lobe.
              \begin{figure}[h]
                \centering
                \includegraphics[scale=0.5]{/Users/grewwc/Desktop/Thesis/roche_lobes.jpg}
                \caption{A schematic diagram of Roche lobe.\protect $L_{1}$ is called inner 
                          Lagrange point which is the intersection of equipotential lines 
                          of star A and B.}
                \label{fig:roche lobe}
              \end{figure}
              We call two stars in an LMXB as A and B respectively for convenience. It is 
              obvious that if an object is close to star A, the gravitational influence of A 
              is so strong that we can nearly ignore the effect of the star B. Similarly, 
              this is true for star B. As a result, there must be a point where the effect 
              of star A is equal to star B which is called inner Lagrange point 
              \cite{0004-637X-603-1-283}. The two parts inside the largest equipotential 
              lines of A and B are called Roche lobe. If star B crosses
              its Roche lobe, than its mass will be attracted by A thus mass transfer between 
              A and B happens. We should notice that this is the main way of mass transfer in 
              LMXB. While in HMXB, the mass can be transferred by strong wind of the massive 
              companion star. 

              What should be noted is that mass transfer can change the distance between two 
              companion stars. If a low-mass star transfer mass to a high-mass companion star,
              the orbital separation will become larger. This can actually stop mass transfer 
              and is a negative feedback. On the contrary, mass transfer from high-mass star 
              to low-mass star will shrink the orbital distance.
                       
        \subsection{Class II MSPs}
          \begin{figure}[h]   
            \centering
            \includegraphics[width=6.9cm,height=7.6cm]{/Users/grewwc/Desktop/Thesis/bands.png}
            \caption{Pulse profiles of PSR B1937+21 in radio, X-ray and gamma-ray.
              \protect \cite{0004-637X-787-2-167}}
            \label{fig:class }
          \end{figure}	 
          Radio emissions are usually considered to be emitted above the polar cap, which means
          radio emissions and gamma-ray emissions are from different location of a pulsar's 
          magnetosphere. However, there are about 10 sources showing aligned pulse profiles in 
          radio and gamma-ray implying that radio emission may produced from outer 
          magnetosphere and they are called Class II MSPs \cite{0004-637X-744-1-33}.
          These pulsars have strong magnetic fields near the light cylinder. 
          Figure \ref{fig:class } is an example of aligned pulse profile.

      \section{Objectives}
        Three millisecond pulsars J0218+4232, B1821-24 and B1937+21 show 
        broadband spectra across radio, X-ray and gamma-ray bands. \textit{Fermi LAT} gives us 
        additional data and tools to do gamma-ray analysis for the pulsars. 
        In year 2015, Fermi team released Pass 8 data including many improvements. Including 
        better energy measurement and 
        significantly improved effective area. Additionally, we have more \textit{Fermi LAT}
        data. As a result, it is reasonable to redo the gamma-ray analysis with the newer 
        dataset and more observation data in order to gain more reliable results. 

        Therefore, my main objective is to use the new data to redo the gamma-ray
        analysis of the three MSPs mentioned above. 
        Then, I will do a numerical simulation based on a theoretical model called 
        two-lay model and test if the new observation data are consistent with the the 
        predictions of the model. And finally, based on numerical simulations of the 
        two-layer emission model, I will generate broadband spectra (including hard X-ray 
        band and gamma-ray band) for all the three MSPs. 

  \chapter{Gamma-Ray Analysis}
    As mentioned before, because of very short rotation periods, MSPs usually have very small 
    light cylinder compared with normal pulsars. As a result, their emission mechanisms are 
    similar to normal pulsars, especially for my target objects --- PSRs J0218+4232, B1937+21 
    and B1821-24, which are among the fastest spinning MSPs. Therefore, as normal pulsars, 
    the three MSPs have broadband emissions so it is convenient to analyze the spectra 
    properties of them in gamma-ray band.
  
    \section{Introduction to the \textit{Fermi Gamma-ray Space Telescope}}
      The \textit{Fermi Gamma-ray Space Telescope} was launched on June 11, 2008 and opened 
      a new window of studying supermassive black-hole systems, pulsars and so on. Its 
      original name was \textit{Gamma-ray Large Area Space Telescope} (GLAST) and changed 
      to \textit{Fermi Gamma-ray Space Telescope} in honor of the great scientist Enrico Fermi. 

      The \textit{Fermi Gamma-ray Space Telescope} contains two parts: 
      \textit{Gamma-ray Burst Monitor (GBM)} and \textit{Large Area Telescope (LAT)} and the 
      latter is the main instrument which is at least 30 times more sensitive than 
      all gamma-ray telescopes launched before. I only use LAT for my purposes. Thus I 
      focus on the LAT instrument, which contains four main subcomponents including tracker, 
      calorimeter, anti-coincidence detector and data acquisition system. The reason why the 
      telescope is designed in this way is that high-energy gamma-rays cannot be refracted by
      lens or mirrors. Therefore, the ways that the \textit{Fermi LAT} and other gamma-ray 
      telescopes operates are completely different. 

      \begin{figure}[!ht]  
        \centering
          \includegraphics[scale=0.7]
                  {/Users/grewwc/Desktop/Thesis/Gamma_telescope_schematic.png}
          \caption{The figure (\blackhref{https://www-glast.stanford.edu/instrument.html}
                  {https://www-glast.stanford.edu/instrument.html})
                  illustrates how \textit{Fermi LAT} tracks incident gamma-ray photons.}
          \label{fig:fermi schematic}
      \end{figure}
      Figure \ref{fig:fermi schematic} demonstrates the very basic idea of the 
      \textit{Fermi LAT} working principles. 

      \begin{itemize}
        \item Gamma-ray photons can enter the anti-coincidence detector freely while 
          cosmic-rays will generate signals which then tell the data acquisition system 
          component to reject these particles. In this way, the \textit{Fermi LAT} can 
          distinguish the gamma-ray photons from high energy cosmic-rays and the confidence 
          is over 99.9\%. 
        \item The conversion foil (shown in Figure \ref{fig:fermi schematic}) can convert  
          gamma-ray photons into electron and positron pairs. This procedure makes it 
          possible to determine the directions of the incident gamma-ray photons. 
        \item The tracker (particle tracking detectors in Figure \ref{fig:fermi schematic}) 
          records the positions of the electrons and positrons generated from the gamma-ray 
          photons. There are many trackers so the paths of a particles can be constructed by 
          doing numerical simulations.
        \item When the electrons and positrons reach the calorimeter, their energies can be
          measured. By calculating the energy relationships between the gamma-ray photons and 
          the correspond electrons and positrons, the energies of the original gamma-ray 
          photons can also be obtained. 
        \item The data acquisition system is like a filter of gamma-ray photons which can 
          reject unwanted particles such as cosmic-rays. Also, photons come from the Earth's 
          atmosphere are also rejected. 
      \end{itemize}

      For a telescope, the ability of measuring the directions and energies of incident 
      photons is very crucial. From the above descriptions of the \textit{Fermi LAT} 
      working principles, we know that the precision of construction of particles' paths 
      heavily influences how well we can measure the directions and energies of gamma-ray 
      photons. And this process is greatly dependent on simulation algorithms, which means 
      that with the improvements of algorithms and datasets,
      the precision of the telescope can also be improved. The Pass 8 data 
      have reprocessed the entire Fermi mission dataset so the quality of the dataset is much 
      better. This is part of the reason why I redo the analysis of the three MSPs.

      \section{A Brief Introduction to Fermi Data Analysis}
        \subsubsection{Brief Introduction to Intermediate Products}
          Instead of producing the final results directly, there are some intermediate 
          procedures and corresponding products such as count maps, count cubes and so on as 
          described below.

        \begin{itemize}
          \item A count map is basically generated by following steps. Firstly, we choose a 
            pixel with a certain size. Then we check each photon's direction to determine if 
            the photon is in this pixel. If it is in the pixel, the photon counts of the 
            pixel will add one. Therefore the more photons fall within the pixel, the more 
            photon counts the pixel has, hence the brighter the pixel is. By doing the same 
            thing for every pixel in the ROI, a count map can be generated. A count map tells 
            us know what we have observed intuitively and gives us a very basic idea of if 
            we get the desired data. 
          \item A count cube is very similar to a count map, except that a count cube 
            contains many energy bands. For example, a dataset whose energy range is from 
            $100\mbox{MeV}$ to $100\mbox{GeV}$ can be divided into 30 bins. We can
            generate a count map in each energy bin, thus we have 30 count maps. In other 
            words, we can regard a count cube as a combination of multiple count maps. 
            A count cube's advantage over a count map is that we can 
            observe distribution of gamma-ray photons in different energy ranges. 
          \item \mayAdd{may have more items}
        \end{itemize}

        \subsubsection{Processes of Doing Fermi Analysis}
          When doing \textit{Fermi LAT} data analysis, I basically dealt with two parts. The 
          first part is processing observation data and the second is generating photon 
          distribution based on models. Cleaning data is straightforward including data 
          selection, data filtering with good time intervals (GTIs), generating count maps 
          and so on. Generating model-based count maps and count cubes needs a little bit 
          more efforts and mainly includes the following procedures. 

          Firstly, I need to generate a spectra model of all sources in our region of 
          interest (ROI). The model basically describes how strong each source is in 
          different energy bands and different positions. The initial parameters of the 
          model are from Fermi database. I do not fit positions of both point sources and 
          diffuse sources when do the data analysis. However, the model alone is not very 
          helpful and I have to know other informations in order to simulate photon 
          distribution. 

          Since I am going to compare my simulation with the observation data, I have to take 
          the telescope states into account. For example, the effective area of telescope 
          decreases when away from the optical axis. In addition, inclination angles and 
          observation time intervals have direct influences on the number of photon counts. 
          In short, after I get the simulated photon distribution from our model, it is 
          necessary to transfer the initial simulation into the real simulation by applying 
          the telescope functions. 
          
          After obtaining the photon distributions and spectra simulations, 
          I then can do comparisons in order to get the maximum likelihood. I divide the 
          total energy band into many smaller energy bins and denote
          the number of photon counts in observation data as $n_{i}$, so that 
          $\sum_{i}^{}n_{i} = N$, where $N$ is the total number of photons we have observed. 
          The observed number of photon counts in $ith$ bin is a Poisson distribution with a 
          mean of $m_{i}$. In fact, the value $m_{i}$ is the expected number of photon counts 
          from our spectra model. Therefore, the distribution for $ith$
          bin can be expressed by Eq. \ref{func: maximum_likelihood_poisson}, where 
          $P_{i}\left(n_{i}\right)$ is the possibility of observing the $n_{i}$ photon counts 
          for the $ith$ bin. 

          \begin{equation}
            P_{i}\left(n_{i}\right) = \frac{e^{-m_{i}} m_{i}^{n_{i}}}{n_{i}!}
            \label{func: maximum_likelihood_poisson}
          \end{equation}

          As a result, it is not hard to generalize the possibility for each bin to all bins, 
          just by multiplying the possibilities for different bins.
          \begin{eqnarray}
            P_{total} &=& \prod_{i}^{}P_{i}\left(n_{i}\right) \nonumber \\ 
                      &=& e^{-\sum_{i}^{}m_i}\prod_{i}^{}\frac{m_{i}^{n_i}}{n_i!}
            \label{func: maximum_likelihood_poisson_all}
          \end{eqnarray}
          In Eq. \ref{func: maximum_likelihood_poisson_all}, $n_i$ is directly 
          from observation data so they usually can not be changed during the binned likelihood 
          analysis. However, by changing the model, the $m_i$ can be altered. 
          Hence, my aim is to tweak the spectra model in order to make the total possibility 
          $P_{total}$ as large as possible. 

          This is the basic idea and procedure of doing Fermi data analysis. After doing these,
          we can go further such as testing how significant our targets are by creating TS 
          maps. The thesis basically follows the procedures. 

          Before finishing this part, I should briefly introduce the basic idea of TS maps. 
          TS stands for Test Statistic which can be expressed as Eq. \ref{func: ts_definition}
          \begin{equation}
            TS = -2 \ln{\frac{L_{max,0}}{L_{max,1}}}
            \label{func: ts_definition}
          \end{equation}
          where $L_{max,0}$ and $L_{max,1}$ are the maximum likelihood of models in which our 
          target source is not included and included respectively. According to Eq. 
          \ref{func: ts_definition}, the larger the TS value is, the larger $L_{max, 1}$ is, 
          which means that the probability of existence of our target source is larger. 
          In order to generate a TS map, we divide the whole map into many sub-grids. In each 
          sub-grid, the algorithm basically does two things. The first procedure is 
          calculating the maximum likelihood value directly based on our spectra model 
          ($L_{max,0}$). Then it adds an imaginary source, fits the source 
          and gets the maximum likelihood ($L_{max, 1}$) value. Therefore, we have two 
          maximum likelihood values. In the end, it calculate the TS value for the 
          sub-grid according to Eq. \ref{func: ts_definition}. 

          After having the TS values for all sub-grids, we can generate a TS map just by 
          rendering colors according to each grid's TS value. By comparing TS values of 
          each grid in a TS map, we can determine where the target source is most likely to 
          be and how large the probability is. 
          
          Generally speaking, for each source, I generate two TS maps and determine how likely 
          my target source is observed. For instance, if the data show the source is observed, 
          then the value of each pixel of the TS map containing the source should be low. 
          On the contrary, the TS values of the pixels around the position of the target 
          source should be significantly higher than other positions in the TS map.
       
        \section{\textit{Fermi LAT} Data Analysis}
          The basic idea of fitting spectra parameters is to make the count cube generated by 
          the model be as similar to the observation data as possible. The calculation process 
          can be summarized as follows. First of all, we have to generate a spectral model 
          for every source in the region of interest (ROI) based on the Fermi database.
          The database includes LAT four-year Point Source Catalog (3FGL), Galactic 
          diffuse emission (gll\_iem\_v06.fits) and isotropic emission 
          (iso\_P8R2\_SOURCE\_V6\_v06.txt). Then we can produce a count cube based on the 
          model. Generally speaking, the difference of the count cubes between the model and 
          observation is obvious. Then, the Fermi software adjusts the parameters 
          to make the difference smaller. Until the errors are acceptable, the software 
          outputs the final fitted parameters of corresponding spectral models.  

          We use a power-law with exponential-cutoff (PLExpCutoff) model to fit the 
          observation data and it is a special case of the power-law with 
          super-exponential-cutoff (PLSuperExpCutoff) model. The spectra of PLSuperExpCutoff 
          can be described by Eq. \ref{eq: fermi_model}:  
          \begin{equation} 
            \label{eq: fermi_model}
            \frac{dN}{dE} = N_{0} \left(\frac{E}{E_0}\right)^{\gamma_1}\mbox{exp}\left[-\left(\frac{E}{E_c}\right)^{\gamma_2}\right]
          \end{equation}  
          where $N_0$ is prefactor, $E_c$ is the cutoff energy and the $E_0$ is a scale 
          parameter. PLExpCutoff model is the special case where $\gamma_2=1$. My aim is to 
          fit the parameters $N_0$, $E_c$ and $\gamma_1$ to make the model be more 
          consistent with the observation data.

        \subsection{Verifying the Data Analysis Process}
          Before analyzing the observations of my target sources, it is reasonable to test 
          if my procedures of data processing are right. In order to do so, I try to do 
          analysis for two bright pulsars PSRs J0007+7303 and J0534+2200. The reason I choose 
          these two pulsars is that according to previous studies, they are bright and easy 
          to detect with a large TS value of 43388 and 102653 for J0007+7303 and J0534+2200 
          respectively. \cite{0067-0049-208-2-17} 

          In the spectra fit process, I do not use the same fit parameters as the previous 
          paper, (for instance, the number of free parameters in the ROI is different)
          however, I get similar results in terms of spectra index.  
          In Table \ref{table: previous_result_comparison}, I used the observation data from 
          2009-01-01 to 2013-02-01 in order to try to be consistent with the old paper 
          \cite{0067-0049-208-2-17}. In addition, I also fit spectra with observation data up 
          to 2018-02-01 and Pass 8 dataset to test how big improvement I can make with the 
          new \textit{Fermi Pass 8} dataset and more observation data. 
          The results of year 2018 data are shown in Table \ref{table: 2018_fit_data}.

          Tables \ref{table: previous_result_comparison} and \ref{table: 2018_fit_data} mainly 
          show two pieces of information. Firstly, my procedures of dealing with observation 
          data has no obvious problems, so basically I can trust fit results of my target 
          sources. Secondly, the \textit{Fermi Pass 8 Lat Data} has improved the accuracy a 
          lot. For example, as Table \ref{table: previous_result_comparison} shows, the photon 
          indexes are $1.30\pm0.02$ and $1.4\pm0.1$, which shows that the errors reduce a lot. 
          Additionally, the TS value is more than double as before.
          \question{However, the cutoff energies are not consistent between the previous result and the new result.
            (I need to explain this a little bit later).}
          \vspace{1cm} 
          \begin{table}[!ht]
            \centering
            \scalebox{0.8}{
            \begin{tabular}{|c|c|c|c|c|c|c|} 
              \hline 
              & \multicolumn{3}{|c|}{Test Results} & \multicolumn{3}{|c|}{Previous Results} \\ 
              \cline{2-7}
              & $\Gamma$ & $E_c$ (MeV) & TS & $\Gamma$ & $E_c$ (MeV) & TS \\ 
              \hline
              J0007+7303 & $1.30\pm0.02$ & $2010\pm85$ & $96979$ & $1.4\pm0.1$ & $4700\pm200$ & $43388$  \\
              \hline 
              J0534+2200 & $2.07\pm0.01$ & $9880\pm572$ & $239015$ & $1.9\pm0.1$ & $4200\pm200$ & $102653$  \\
              \hline
            \end{tabular}}
            \vspace{0.5cm}
              \centering
              \mycaption{The spectra fit results. In the thesis, in order to make data 
                analysis more convinient, we use some pipeline scripts to deal with the 
                observation data. The "Test Results" column is the results generated by 
                using the pipeline scripts. The "Previous Results" column lists the 
                corresponding spectra properties based on the old paper 
                \cite{0067-0049-208-2-17}. According to the standard PLSuperExpCutoff model 
                (described in equation \ref{eq: fermi_model}, $\Gamma$ is photon index 
                and $E_c$ is cutoff energy.)}
              \label{table: previous_result_comparison}
          \end{table}
          \vspace{1cm}            

          \begin{table}[!ht]
            \centering
            \scalebox{0.85}{
            \begin{tabular}{|c|c|c|c|}
              \hline 
              &$\Gamma$& $E_c$ (MeV) & TS \\ \hline 
              J0007+7303 & $1.34\pm0.02$ & $2204\pm67$ & $210166$ \\ \hline 
              J0534+2200 & $2.01\pm0.01$ & $9173\pm372$ & $449946$ \\ \hline
            \end{tabular}}
            \mycaption{Fit results with data from year 2009 to year 2018. The physical 
              meanings of $\Gamma$ and $E_c$ are the same as Table 
              \ref{table: previous_result_comparison}.}
            \label{table: 2018_fit_data}
          \end{table}
          \vspace{1cm}            

        \section{PSR J0218+4232}
          % \label{j0218}
          The ROI is a circle with radius of $20^\circ$ and all parameters of sources which 
          are $8^\circ$ outside of the center are fixed. For sources within $8^\circ$, initial
          values of parameters are the same as their default values according to \fgl.
          In this case, there are seven point sources which have free parameters. In Figure
          \ref{fig: j0218_count_map_and_model}, the green circles represent those sources.
          There are some very bright sources which have no free parameters
          in the outer parts of the count map. The reason is that the they are so far away 
          from PSR J0218+4232 that \textit{Fermi LAT} can distinguish if a photon comes 
          from the target source or outer sources. As a result, we do not need to fit 
          any parameters for those outer sources and their spectra properties are from 
          \fgl. However, it is different for the nearby sources and we have to fit parameters
          of them.
          
          \subsection{Count Maps And Count Cubes}
            \begin{figure}[!ht]  
              \begin{center}
              \begin{minipage}{0.45\textwidth}
                \begin{center} 
                    \includegraphics[scale=0.4]
                        {/Users/grewwc/Desktop/Thesis/j0218_count_map_with_region.png}
                \end{center}
              \end{minipage}
              \begin{minipage}{0.45\textwidth}
                \begin{center} 
                    \includegraphics[scale=0.4]
                        {/Users/grewwc/Desktop/Thesis/j0218_count_map_model.png}
                \end{center}
              \end{minipage}
            \end{center}
            \begin{center}
              \caption{The count map of PSR J0218+4232 (left) and the count map generated by 
              the model (right). In the left panel, the green circles represent sources needed 
              to be fitted. The right panel is a count map created according to the fitted 
              spectra model. The size of each figure is 141 pixels $\times$ 141 pixels, 
              and the dimension for each pixel is $0.2^\circ \times 0.2^\circ$.}
              \label{fig: j0218_count_map_and_model}  
            \end{center} 
          \end{figure}

          The left part of Figure \ref{fig: j0218_count_map_and_model} is the count map of 
          PSR J0218+4232. In the center of the left panel, we can clearly see the target 
          source. The dimensions of the figures seems to be weird and the reason why the count 
          map is $141$ pixels wide is that I need to select a circle region from the original 
          data. However, when generating a count map, I have to assign the sizes for x and y 
          axis separately, which means that the a count map is actually rectangular. As a 
          result, I have to crop a rectangular from the original circle region and in this 
          case, the rectangular is usually chosen as a square. 
          
          \begin{figure}[!ht]
            \begin{minipage}{0.32\textwidth}
              \begin{center} 
                \includegraphics[scale=0.30]
                      {/Users/grewwc/Desktop/Thesis/j0218_ccube_start.png}
              \end{center}
            \end{minipage}
            \begin{minipage}{0.32\textwidth}
              \begin{center}
                \includegraphics[scale=0.30]
                      {/Users/grewwc/Desktop/Thesis/j0218_ccube_middle.png}
              \end{center}
            \end{minipage}
            \begin{minipage}{0.32\textwidth}
              \begin{center}
              \includegraphics[scale=0.30]
                    {/Users/grewwc/Desktop/Thesis/j0218_ccube_end.png}
              \end{center}
            \end{minipage}
            \caption{Three count maps from PSR J0218+4232's count cube. The energy ranges of 
              the figures are 100$\sim$123MeV, 1.873$\sim$2.310GeV, 35.11$\sim$43.29GeV 
              respectively.}
            \label{fig: j0218_ccube_bin_1_and_15}
          \end{figure}
          
          Figure\ref{fig: j0218_ccube_bin_1_and_15} is a comparison between PSR J0218+4232's 
          count maps in different energy bands. The count map in about $100\mbox{MeV}$ is so 
          messy that we can hardly distinguish the target source while the energy is above 
          $30\mbox{GeV}$ there are so few photons that there is not a clear sign of the source. 
          I choose three circle regions whose centers are the target sources and the radii 
          are 1000 $''$ for all of the three figures and then calculate the total numbers of 
          photon counts of the selected regions. 
          As Table \ref{table:j0218_ccube_photon_counts} shows, though total number of photon 
          counts around the target source is similar between the left and middle count maps, 
          the numbers of counts per energy are much different. Since there are few photons 
          in high energy bands (above $50\mbox{GeV}$) compare to other energy bands, I focus 
          more on the lower energy part. 

          \begin{table}[!h]   
            \centering
            \scalebox{0.85}{
            \begin{tabular}{|m{4.5cm} | c | c | c |}
              \hline 
              & Left & Middle & Right \\
              \hline
              Total counts & 78 & 93 & 0 \\
              \hline 
              Energy range ($MeV$) & 100$\sim$123 & 1873$\sim$2310 & 35110$\sim$43290 \\ 
              \hline
              Counts / MeV ($MeV^{-1}$)& 3.39 & 0.213 & 0.000 \\  
              \hline
            \end{tabular}}
            \mycaption{Numbers of photon counts of count maps in different energy bands for 
                  PSR J0218+4232.}
            \label{table:j0218_ccube_photon_counts}
          \end{table}
          \subsection{Binned Likelyhood Analysis}
            Figure \ref{fig: j0218_count_map_and_model} shows that the fit results of the model 
            are consistent with the observation. However, there are lots of small red pixels 
            in the left panel (generated directly by the observation data) while the 
            right panel is very "clean". This means that a lot of photons are thought as 
            generated by the modeled source. Thus in our model, the sources are generally 
            slightly brighter than the observation. However, the target
            source is an exception. In the region I have used before (the center is the 
            target source, and the radius is 1000$''$), the total photon counts in the left 
            panel are 1815 compare to 1737 in the right panel. 

            The reason why the count map generated directly by the observation data is a lot 
            more messy is that the source model is generated based on the Fermi database 
            and their spatial position is fixed. This means that if 
            a photon comes from a particular direction and there is no any known pulsar in 
            that direction, this photon has to be classified into other directions and there 
            is a modeled source in the direction.  Thus, the spatial positions of photons are 
            different between the observation and the model, and the count maps generated 
            directly from models are usually cleaner. 
            
            % \begin{figure}[!ht]
            %   \begin{minipage}{1\textwidth}
            %     \begin{center} 
            %       \includegraphics[scale=0.6]{/Users/grewwc/Desktop/Thesis/j0218_count_map_diff.png}
            %     \end{center}
            %   \end{minipage}
            %   \centering
            %   \begin{minipage}{0.8\textwidth}
            %     \mycaption{The residual map shows the difference between the observation and the model. 
            %     It is generated by subtracting the photon counts of each pixel between the count maps of 
            %     observation and the model. 
            %     \change{ugly, scale may be wrong}}
            %     \label{fig: j0218_count_map_diff}
            %   \end{minipage}
            % \end{figure}

            \begin{figure}[!ht]
              \begin{center}
              \begin{minipage}{0.45\textwidth}
                \begin{center} 
                  \includegraphics[scale=0.4]
                        {/Users/grewwc/Desktop/Thesis/j0218_count_map_linear_scale.png}
                \end{center}
              \end{minipage}
              \begin{minipage}{0.45\textwidth}
                \begin{center}
                  \includegraphics[scale=0.4]
                        {/Users/grewwc/Desktop/Thesis/j0218_dif_map_linear_scale.png}
                \end{center}
              \end{minipage}
            \end{center}
            \caption{The count map and residual map of PSR J0218+4232.
              The figures are both in linear scale in order to compare the residual map 
              between the original count map more intuitively. The left panel is the count 
              map and the right panel is the residual map which shows the differences between 
              the observation and the spectral model. It is created by directly subtracting 
              the photon counts of each pixel between the count maps of observation data and 
              the spectral model. The green circle region represents (the regions are 
              completely the same in the two figures) the largest number photon counts of the 
              residual map and its radius is $2000''$.}
            \label{fig: j0218_count_map_diff}
            \end{figure}

            Figure \ref{fig: j0218_count_map_diff} basically describes how well the model is 
            compared to the observation data. There are some black dots and bright dots in 
            the residual map showing the differences between the spectral model and the 
            observation data. In the residual map of Figure \ref{fig: j0218_count_map_diff}, 
            most differences of absolute photon counts are small, however, in the green 
            circle region, the absolute value 6003 is large. This means that in this region,
            the number of photon counts of the observation data (21525) is 6003 larger than 
            in our model. This is not negligible since it is nearly $28\%$ of the original 
            photon counts. Does this mean that the model is not good? The answer should be 
            yes, however, this does not mean the fit is not good since the model parameters 
            in this region are all fixed and the fixed values are from the Fermi LAT 4-year 
            Point Source Catalog. Hence, the difference shows some problems of the spectral 
            model, but has nothing to do with the fit results. Instead, from the residual map, 
            we can see that the fit results are good because the differences
            of number of photon counts are very low, which are about $5\%$ of the photon 
            counts of the count map on average.

            Table \ref{table: j0218_fit_result} lists the results of the fit parameters. 
            We see from Table \ref{table: j0218_fit_result} that the new fit results are 
            consistent with the old ones. However, the precision improves a lot which is 
            ascribed to the \textit{Fermi LAT Third Source Catalogue} and \textit{PASS 8} 
            data. Figure \ref{fig: j0218_cur_with_data_points.png} is a plot of the spectrum 
            according to Function \ref{eq: fermi_model}.
            One thing should be noticed is that we need to multiply $E^2$ to Function \ref{eq: fermi_model} 
            % in order to get the flux. Figure \ref{fig: j0218_cur_with_data_points.png} shows that the global 
            fit is consistent with flux points fitted by each energy bin separately. 
            The TS value of our target source is 7110, which gives us 
            a significance level $\sigma \approx \sqrt{TS} = 84$. This strongly implies the presence of our
            target source. We can also use a TS map to test the presence of the source as Figure
            \ref{fig: j0218_tsmap_comparison_20} shows. 
            
            \begin{table}[!ht]
              \centering
                \scalebox{0.8}{
                \begin{tabular}{|c|c|c|c|c|}
                  \cline{1-5}
                  & \multicolumn{2}{|c|}{This Study} & \multicolumn{2}{|c|}{Previous Results} \\
                  \cline{1-5}
                  & Value & Error & Value & Error \\
                  \hline
                  Index1 ($\gamma_1$) & $1.89492$ & $0.04044$ & $2.0$ & $0.1$ \\
                  \hline 
                  Cutoff ($E_c$, MeV) & $3766.69$ & $397.38$ & $4600$ & $1200$ \\
                  \hline 
                  Photon Flux (ph $cm^{-2} s^{-1}$) ($10^{-8}$) & $7.28913$ & $0.27988$ & $7.7$ & $0.7$ \\ 
                  \hline
                \end{tabular}}  
                \mycaption{Fit parameters of the spectral model of PSR J0218+4232. 
                  The names of parameters are consistent with Eq.
                  \ref{eq: fermi_model}. The old results are from the paper \cite{0067-0049-208-2-17}.}
                \label{table: j0218_fit_result}        
            \end{table}  

            \singleFig{j0218_cur.png}{0.40}{The log-log plot of flux to energy of PSR J0218+4232. The grey shade represents 
              fitting errors, black points with error bars are flux points, the blue dots are upper values and the 
              red line is the PLExpCutoff model multiplied by $E^2$. Flux points 
              are fitted separately by dividing the total energy bin (100 MeV $\sim$ 100 GeV) into multiple energy bins.
              The horizontal error bars represents the width of each bin. }
            \vspace{1cm}
            % \singleFigureblank.png}{0.3}{\change{Figurereshould be a TS map, but the new TS map has not been generated yet.
            % The previous TS map does not use the best fit parameters, so I have to re-generate the TS map. And this 
            % world map is just a reminder and it may be used a lot.}}
            \begin{figure}[!ht]
              \begin{center}
              \begin{minipage}{0.46\textwidth}
                \begin{center} 
                  \includegraphics[scale=0.37]{/Users/grewwc/Desktop/Thesis/j0218_tsmap_with_source_20.png}
                \end{center}
              \end{minipage}
              \begin{minipage}{0.45\textwidth}
                \begin{center}
                  \includegraphics[scale=0.37]{/Users/grewwc/Desktop/Thesis/j0218_nosource_20.png}
                \end{center}
              \end{minipage}
            \end{center}
            \caption{TS maps of PSR J0218+4232. The figures' dimensions are 
            $4^{\circ} \times 4^{\circ}$ ($20$ pixels $\times$ $20$ pixels with 
            $0.2^{\circ} \times 0.2^{\circ}$ for each pixel). The \textsf{left}
            figure and \textsf{right} figure are generated by the xml models with and without our 
            target source PSR J0218+4232 respectively. The \textsf{left} figure shows that the 
            possibility of adding an imputative point source is very low only with a maximum TS value of 
            less than 5. However, the \textsf{right} figure strongly implies that there should be an 
            additional source after we have removed our target source from the spectral model, 
            which means it's highly likely that PSR J0218+4232 is contained in our observation data.}
            \label{fig: j0218_tsmap_comparison_20}
            \end{figure}

            % \begin{figure}[!ht]
            %   \begin{center}
            %   \begin{minipage}{0.45\textwidth}
            %     \begin{center} 
            %       \includegraphics[scale=0.45]{/Users/grewwc/Desktop/Thesis/j0218_tsmap_with_source_20.png}
            %     \end{center}
            %   \end{minipage}
            %   \begin{minipage}{0.45\textwidth}
            %     \begin{center}
            %       \includegraphics[scale=0.45]{/Users/grewwc/Desktop/Thesis/j0218_nosource_20.png}
            %     \end{center}
            %   \end{minipage}
            % \end{center}
            %   \mycaption{TS maps for PSR J0218+4232. Figureres' dimensions are 
            %   $4^{\circ} \times4^{\circ}$ ($20$ pixels $\times$ 20 $pixels$ with 
            %   $0.25^{\circ} \times 0.25^{\circ}$ for each pixel). Figureres' meanings 
            %   are completely the same with Figure \ref{fig: j0218_tsmap_comparison_15}}
            %   \label{fig: j0218_tsmap_comparison_20}
            % \end{figure}
            % After obtaining the spectra fit results in gamma-ray band, we can generate a broad band spectrum. 
            % The hard X-ray data is from the paper  
            % \blackhref{https://arxiv.org/pdf/1704.02964.pdf}{NUSTAR HARD X-RAY OBSERVATIONS OF THE ENERGETIC   %
            % MILLISECOND PULSARS PSR B1821-24, PSR B1937+21, AND PSR J0218+4232}. We also generate simulation data
            % from the two-layer model. Then we compare the simulation and observation as the Figure
            % \ref{fig: J0218+4232} shown. The prediction of the two-layer model is consistent with the observation
            % both in X-ray band (from about 3 keV to 10 MeV) and high energy gamma-ray band (above 1 GeV). However, 
            % from about 100 MeV to 1 GeV, the spectrum from the two-layer model is not consistent with Fermi data. 
            % This can have 2 explanations. Firstly, the Fermi telescope is not sensitive in about 100 MeV.
            % As a result, the observation data may not be very reliable at about this energy band. Secondly, the  
            % real emission mechanism in the energy band is different from the model predicts. Thus, we can observe 
            % inconsistency between the simulation and observation.

            % \singleFigureJ0218+4232}{0.35}{\Notice{have to uniformly change the style of figures later.}}

            We can also check the count residuals of the fit as Figure 
            \ref{fig: j0218_count_spectra} shows. The galactic and isotropic emission are very 
            bright compared with the target source and this can bring some difficulties to 
            the fit. The residuals and fluctuations become larger and more obvious 
            when the energy is larger than $100\mbox{MeV}$. 
            Meanwhile, since the total number of counts in high energy bands 
            is significantly smaller than in low energy bands, the error bars becomes much 
            larger above $100\mbox{MeV}$. At the same time, in low gamma-ray part 
            (from $100\mbox{MeV}$ to $200\mbox{MeV}$), the number of counts of the model 
            deviates from observation counts obviously because of the relatively low energy 
            resolution in low-energy gamma-ray part. The error of the first bin is larger
            than the next several bins in Figure \ref{fig: j0218_cur.png} can also shows that 
            the fit in low-energy gamma-ray band (from $100\mbox{MeV}$ to $200\mbox{MeV}$) 
            is not as good as higher energy bands (but not too high). 
            
            \begin{figure}[!ht]
              \centering
              \includegraphics[scale=0.47]{/Users/grewwc/Desktop/Thesis/j0218_count_spectra.png}
              \caption{The upper panel is the count spectrum of all sources included in the 
                      fit procedure. Thick lines are those sources with free fit parameters 
                      while the thin lines are fixed sources. The green line and the black 
                      dots represents observed counts in different energy bands. The purple 
                      line represents galactic emission. The lower panel shows the count 
                      residuals in different energy bands. } 
              \label{fig: j0218_count_spectra}
            \end{figure}

            \section{PSR B1821-24}
              The ROI region is a circle whose radius is $20^\circ$ and all 
              parameters of sources outside of $8^\circ$ are fixed. 
              There are six free sources in the region of $8^\circ$. Figure
              \ref{fig: b1821_count_map_with_region_and_model} 
              is a combination of count maps of observation data and the model. 

              \subsection{Count Maps And Count Cubes}
                \begin{figure}[!ht]
                  \begin{center}
                  \begin{minipage}{0.45\textwidth}
                    \begin{center} 
                      \includegraphics[scale=0.37]{/Users/grewwc/Desktop/Thesis/b1821_count_map_with_region.png}
                    \end{center}
                  \end{minipage}
                  \begin{minipage}{0.45\textwidth}
                    \begin{center}
                      \includegraphics[scale=0.375]{/Users/grewwc/Desktop/Thesis/b1821_count_map_model.png}
                    \end{center}
                  \end{minipage}
                \end{center}
                \mycaption{The count map of PSR B1821-24 (left) and the count map generated by the 
                model (right). In the left panel, the green circles are free sources. The sizes of the both 
                figures are 141 pixels $\times$ 141 pixels, and each pixel's dimension is 
                $0.2^\circ \times 0.2^\circ$.}
                \label{fig: b1821_count_map_with_region_and_model}
              \end{figure}
            
              \begin{figure}[!ht]
                \begin{center}
                \begin{minipage}{0.31\textwidth}
                  \begin{center} 
                    \includegraphics[scale=0.27]{/Users/grewwc/Desktop/Thesis/b1821_ccube_start.png}
                  \end{center}
                \end{minipage}
                \begin{minipage}{0.31\textwidth}
                  \begin{center}
                    \includegraphics[scale=0.27]{/Users/grewwc/Desktop/Thesis/b1821_ccube_middle.png}
                  \end{center}
                \end{minipage}
                \begin{minipage}{0.31\textwidth}
                  \begin{center}
                  \includegraphics[scale=0.27]{/Users/grewwc/Desktop/Thesis/b1821_ccube_end.png}
                  \end{center}
                \end{minipage}
              \end{center}
              \mycaption{Three figures of PSR B1821-24's count cube. The energy ranges of the figures are  
                100$\sim$123MeV, 1.873$\sim$2.310GeV, 81.11$\sim$100GeV respectively from left to right.}
              \label{fig: b1821_ccube_1_15_33.png}
              \end{figure}

              The left and right part of Figure \ref{fig: b1821_count_map_diff.png} is the count 
              map of the PSR B1821-24 generated from observation data and spectral model respectively. 
              Like the situations of PSR J0218+4232, the count map from the model is clearly cleaner than 
              from the observation data and the two figures are very similar, which implies that our model 
              is close to the observation data. 

              Figure \ref{fig: b1821_ccube_1_15_33.png} are count maps of PSR B1821-24 in 
              different energy bands. The target pulsar is too faint in very high energy bands 
              and interfered too much by the ambient environment in low energy bands 
              (around 100MeV). Because our target source is near the M28 globular cluster and 
              very faint, it is reasonable that the fitting result is not as good as 
              PSR J0218+4232. 
              \subsection{Binned Likelihood Analysis}
              \begin{figure}[!ht]
                \begin{center}
                \begin{minipage}{0.45\textwidth}
                  \begin{center} 
                    \includegraphics[scale=0.40]{/Users/grewwc/Desktop/Thesis/b1821_countmap_noregion.png}
                  \end{center}
                \end{minipage}
                \begin{minipage}{0.45\textwidth}
                  \begin{center}
                    \includegraphics[scale=0.40]{/Users/grewwc/Desktop/Thesis/b1821_count_map_diff.png}
                  \end{center}
                \end{minipage}
              \end{center}
              \caption{The count map and residual map of PSR B1821-24 in log scale. 
              The reason why linear is not used here is that the residual map is nearly black in linear scale.
              The \textsf{left} figure is the count map and the \textsf{right} 
              figure is the residual map showing the difference between the observation data and the spectral model.}
              \label{fig: b1821_count_map_diff.png}
            \end{figure}

            \singleFig{b1821_cur.png}{0.40}{The log-log plot of flux to energy of 
              PSR B1821-24's gamma-ray spectrum.}
              \vspace{1cm}

            The differences of the count map between the observation data and the model are described as Figure 
            \ref{fig: b1821_count_map_diff.png} which are both in linear scale. In the right part of Figure, 
            there are some black dots 
            with absolute values about $-800$. Though their values are relatively high, the number of 
            high-value dots are very small so the fit is acceptable in general. 

            Table \ref{table: b1821_fit_result} shows the global fit results of PSR B1821-24. 
            The TS value of the model is 941 which gives us a significance level 
            of about $\sqrt{941} \sim 31$. This strongly supports the existence of the target source in 
            the observation data.

            Figure \ref{fig: b1821_twolayer_cur.png} shows that the global fit is consistent with 
            the flux points generated by fitting sub-energy bins separately. However, 
            we should notice the first flux point 
            which is denoted as a blue square in Figure \ref{fig: b1821_twolayer_cur.png}. This 
            flux point is significantly smaller than the global fit (the red line in the figure). 
            In addition, the upper value for the first energy bin is still slightly smaller than the global fit. 
            Though it is strange that the upper value is smaller than the normal value at first glance, 
            it is reasonable since the flux points are fitted separately and are independent to 
            the global fit. In fact, we use a single power-lay model to fit each sub-energy bin while PLExpCutoff
            model to do the global fit. As we have explained previously, the lower energy parts of the 
            observation (around 100 MeV) is not as reliable as other energy bands. As a result, the separate 
            fit for the first energy bin
            is not as reliable as the global fit and it is reasonable that the two fit results are not completely
            consistent. When this happening, we have more confidence on the global fit than the separate fit.
            
            \begin{table}[!ht]
              \centering
                \scalebox{0.8}{
                \begin{tabular}{|c|c|c|c|c|}
                  \cline{1-5}
                  & \multicolumn{2}{|c|}{This Study} & \multicolumn{2}{|c|}{Previous Results} \\
                  \cline{1-5}
                  & Value & Error & Value & Error \\
                  \hline
                  Index1 ($\gamma_1$) & $1.906$ & $0.068$ & $0.96$ & $0.22$ \\
                  \hline 
                  Cutoff ($E_c$, MeV) & $4501.92$ & $710.41$ & $1410$ & $300$ \\
                  \hline 
                  Photon Flux (ph $cm^{-2} s^{-1}$) ($10^{-8}$) & $3.85$ & $0.31$ & $2.39$ & $0.22$ \\ 
                  \hline
                \end{tabular}}  
                \mycaption{Fit parameters of the spectral model of PSR B1821-24. 
                  The names of parameters are also onsistent with Eq.
                  \ref{eq: fermi_model} 
                  We should note that the energy ranges of photon flux between the two results are different.
                  The energy is from 100MeV to 100GeV for the new results while from 200MeV to 300GeV for the 
                  previous results.}
                \label{table: b1821_fit_result}        
            \end{table}  
            \vspace{1cm}
              % \singleFigureblank.png}{0.3}{\change{Figurereshould be a TS map, but the new TS map has not been generated yet.
              % The previous TS map does not use the best fit parameters, so I have to re-generate the TS map. And this 
              % world map is just a reminder and it may be used a lot.}}

            \begin{figure}[!ht]
              \begin{center}
              \begin{minipage}{0.46\textwidth}
                \begin{center} 
                  \includegraphics[scale=0.35]{/Users/grewwc/Desktop/Thesis/b1821_tsmap_with_source_20.png}
                \end{center}
              \end{minipage}
              \begin{minipage}{0.45\textwidth}
                \begin{center}
                  \includegraphics[scale=0.35]{/Users/grewwc/Desktop/Thesis/b1821_tsmap_nosource_20.png}
                \end{center}
              \end{minipage}
            \end{center}
            
            \caption{TS maps of PSR B1821-24. The figures' dimensions are $4^{\circ} \times4^{\circ}$ 
            ($20$ pixels $\times$ $20$ pixels with $0.2^{\circ} \times 0.2^{\circ}$ for each pixel). 
            The \textsf{left} figure and \textsf{right} figure are generated by the XML models with and without our 
            target source PSR B1821-24 respectively. The \textsf{left} figure shows that the possibility 
            of adding an imputative point source is very low only with a maximum TS value of 
            less than 11 while the TS values of the \textsf{right} figure are generally much larger.}
              \label{fig: b1821_tsmap_comparison_20}
            \end{figure}
            \vspace{1cm}

            % \begin{figure}[!ht]
            %   \begin{center}
            %   \begin{minipage}{0.45\textwidth}
            %     \begin{center} 
            %       \includegraphics[scale=0.43]{/Users/grewwc/Desktop/Thesis/b1821_tsmap_with_source_20.png}
            %     \end{center}
            %   \end{minipage}
            %   \begin{minipage}{0.45\textwidth}
            %     \begin{center}
            %       \includegraphics[scale=0.37]{/Users/grewwc/Desktop/Thesis/b1821_tsmap_nosource_20.png}
            %     \end{center}
            %   \end{minipage}
            % \end{center}
            % \mycaption{TS maps of PSR B1821-24. Figureres' dimensions are $4^{\circ} \times4^{\circ}$ 
            % ($20$ pixels $\times$ $20$ $pixels$ with $0.25^{\circ} \times 0.25^{\circ}$ for each pixel). 
            % The meaning of Figure is the same as Figure \ref{fig: b1821_tsmap_comparison_15}}
            % \label{fig: b1821_tsmap_comparison_15}
            % \end{figure}
            % \vspace{1cm}
      
      
          \begin{figure}[!ht]
            \centering
            \includegraphics[scale=0.45]{/Users/grewwc/Desktop/Thesis/b1821_count_spectra.png}
            \caption{The upper panel is the count spectrum of all sources included in the 
                    fit procedure. Thick lines are those sources with free fit parameters 
                    while the thin lines are fixed sources. The green line and the black 
                    dots represents observed counts in different energy bands. The purple 
                    line represents galactic emission. The lower panel shows the count 
                    residuals in different energy bands. } 
            \label{fig: j0218_count_spectra}
          \end{figure}


        \section{PSR B1937+21}
          \subsection{Phase Averaged Analysis}

          \subsection{Phase Resolved Analysis}
          In order to make the data analysis be more consistent, I choose the same parameters
          to process the raw observation data. Like the other two MSPs, the radius of the ROI 
          is $20^{\circ}$ degrees, and all parameters of sources $8^{\circ}$ degrees outside 
          from the center are fixed with default values. Figure \ref{fig: j1939_count_map} is 
          the comparison of count maps between observation data.

          \subsubsection{Count Maps and Count Cubes}
            \begin{figure}[!ht]
              \begin{center}
              \begin{minipage}{0.45\textwidth}
                \begin{center} 
                  \includegraphics[scale=0.38]{/Users/grewwc/Desktop/Thesis/j1939_cmap.png}
                \end{center}
              \end{minipage}
              \begin{minipage}{0.45\textwidth}
                \begin{center}
                  \includegraphics[scale=0.38]{/Users/grewwc/Desktop/Thesis/j1939_cmap_model.png}
                \end{center}
              \end{minipage}
            \end{center}
 
          \caption{The count maps of PSR B1937+21 created from observation 
              data (\textsf{left}) and from the spectral model (\textsf{right}). The dimensions
              of both figures are $141 pixels \times 141 pixels$ and each pixel's size is
              $0.2^{\circ}\times0.2^{\circ}$.}
            \label{fig: j1939_count_map}
          \end{figure}

          There are four point sources with free parameters in the model which are represented 
          by the green circles in Figure \ref{fig: j1939_count_map}.
          However, the left panel of Figure \ref{fig: j1939_count_map} only contains three 
          circles. This is the difference between the PSR B1937+21 and the the other two MSPs 
          discussed above. The PSR B1937+21 is not listed in the 
          \textit{Fermi LAT Third Source Catalogue} may be because that the MSP is very weak.
          and the signal to noise ratio is so low that we could not get reliable spectrum fit 
          results with a large TS value. 

          Therefore, in order to analyze the spectrum of the MSP, I have to add the source 
          manually. The green circles are only created using Fermi tools by default, hence 
          the source is not represented by a green circle. In addition, the count map is so 
          messy that the source PSR B1937+21 is not completely unidentifiable in this count map. 
          Since PSR B1937+21 is not listed in the \textit{Fermi LAT Third Source Catalogue} 
          and I have to generate the model by hand, I need to initialize parameters in the 
          model. Like the other two MSPs, I choose the specified PLSuperExpCutoff model and 
          set the initial value of photon index to be $-2.5$.

          Figure \ref{fig: j1939_count_cube} shows count maps in different energy bands. As 
          the figure shows, the lower energy band is very messy while there is no valuable  
          data in the high energy band. Therefore, the data in the middle energy range is 
          more reliable and when fitting the two-layer model, it has higher priority to 
          minimize the differences between the model and observation data in the middle part.

          \add{Continue from here... \\
            PSR B1937+21 is a little bit different. I did a phase resolved analysis, 
            in order to show if it is necessary, I plan to do a new phase averaged analysis 
            for comparison. The best phase averaged results are not finished completely yet, 
            but soon.}
          \begin{figure}[!ht]
            \begin{minipage}{0.30\textwidth}
              \begin{center} 
                \includegraphics[scale=0.25]{/Users/grewwc/Desktop/Thesis/j1939_ccube_start.png}
              \end{center}
            \end{minipage}
            \begin{minipage}{0.30\textwidth}
              \begin{center}
                \includegraphics[scale=0.25]{/Users/grewwc/Desktop/Thesis/j1939_ccube_middle.png}
              \end{center}
            \end{minipage}
            \begin{minipage}{0.30\textwidth}
              \begin{center}
              \includegraphics[scale=0.25]{/Users/grewwc/Desktop/Thesis/j1939_ccube_end.png}
              \end{center}
            \end{minipage}
            \caption{Three count maps of PSR B1937+21's count cube. The energy ranges of the 
              figures are from $100$ to $123$MeV, from $1.873$ to $2.310$GeV, from $35.11$ to
              $43.29$GeV respectively.}
            \label{fig: j1939_count_cube}
          \end{figure}

        \subsubsection{Binned Likelihood Analysis}
          Figure \ref{fig: j1939_count_map_diff} is a combination of the residual map the 
          original count map of PSR B1937+21 in linear scale. The fact that there are many 
          bright dots in the residual map shows that the global fit is not as good as the 
          other two pulsars. Furthermore, the fit is particularly bad in the cyan circle 
          region in the right bottom part Figure \ref{fig: j1939_count_map_diff}. 
          The total numbers of counts of the cyan region are $18975$ and $4212$ respectively 
          for the count map and the residual map. The center of the region is 
          $\left(290.53^{\circ}, 14.12^{\circ}\right)$ and is about $8.65^{\circ}$ away from 
          the source, which means that parameters of the sources in the region are fixed 
          during the fit. This may be the problem of the method of choosing the phase. 
          Firstly I get the pulse phase of PSR B1937+21 and select $40\%$ of the whole 
          rotation period containing the pulse phase. At the same time, I need to change the 
          scales to $40\%$ of their original values for the sources with no free 
          parameters. This is reasonable, however, for some bright sources, a little 
          difference in percent can cause big residuals of photon counts. 
          \question{Not Sure}

          \subsubsection{Count Maps and Count Cubes}
            \begin{figure}[!ht]
              \begin{center}
              \begin{minipage}{0.40\textwidth}
                \begin{center} 
                  \includegraphics[scale=0.31]{/Users/grewwc/Desktop/Thesis/j1939_cmap_linear.png}
                \end{center}
              \end{minipage}
              \begin{minipage}{0.40\textwidth}
                \begin{center}
                  \includegraphics[scale=0.31]{/Users/grewwc/Desktop/Thesis/j1939_cmap_diff_linear.png}
                \end{center}
              \end{minipage}
              \end{center}

              \caption{The count maps of PSR B1937+21 created from observation 
                data (\textsf{left}) and from the spectral model (\textsf{right}). The dimensions
                of both figures are $141 pixels \times 141 pixels$ and each pixel's size is
                $0.2^{\circ}\times0.2^{\circ}$.}
              \label{fig: j1939_count_map_diff}
            \end{figure}


          % \begin{figure}[!ht]
          %   \begin{center}
          %   \begin{minipage}{0.45\textwidth}
          %     \begin{center} 
          %       \includegraphics[scale=0.34]{/Users/grewwc/Desktop/Thesis/j1939_count_map_linear.png}
          %     \end{center}
          %   \end{minipage}
          %   \begin{minipage}{0.45\textwidth}
          %     \begin{center}
          %       \includegraphics[scale=0.35]{/Users/grewwc/Desktop/Thesis/j1939_count_map_model_linear.png}
          %     \end{center}
          %   \end{minipage}
          % \end{center}
          % \caption{The count maps of PSR B1937+21 created from observation 
          % data (\textsf{left}) and from the spectral model (\textsf{right}). The dimensions
          % of both figures are $141 pixels \times 141 pixels$ and each pixel's size is
          % $0.2^{\circ}\times0.2^{\circ}$.}

          The Figure \ref{fig: j1939_count_spectra} is the combination of count spectra for 
          all sources within the $20^{\circ}$ and the count residual plot. The count residual 
          plot shows that except low gamma-ray energy part (from $100\hbox{MeV}$ to 
          $200\hbox{MeV}$), the total number of photon counts of the model is very close to 
          the observation data. This seems good, but can also imply more problems. 
          As previously discussed, the modeled number of photon counts in the cyan circle 
          is $7924$ smaller than the observation data. And the count residual plot shows that 
          the count number of the whole map is nearly the same, which means that in the model
          there must be some sources forced to be larger than the real value to make up for 
          the deficiency. This implies that the fit results of some sources with free 
          parameters are not as good as the Figure \ref{fig: j1939_count_spectra} shows. 
          
          \begin{figure}[!ht]
            \centering
            \includegraphics[scale=0.42]{/Users/grewwc/Desktop/Thesis/j1939_count_spectra.png}
            \caption{The count spectra (top) of all sources including those with only fixed 
              parameters and count residuals (bottom) of the fit for PSR B1937+21.}
            \label{fig: j1939_count_spectra}
          \end{figure}

          Table \ref{table: j1939_fit_result} lists the results of the fit parameters of 
          PSR B1937+21. We see from the table that the new fit results are 
          consistent with the old ones and the precision improves a lot. 
          Figure \ref{fig: j1939_cur_with_data_points} is a plot of the spectrum 
          according to Function \ref{eq: fermi_model}.
          The global fit is consistent with flux points fitted by each energy bin separately 
          as the flux points and the red line with shade shows.  
          The TS value of our target source is $383$, which gives us 
          a significance level $\sigma \approx \sqrt{TS} = 19.6$. This implies the presence 
          of the target source. We can also use a TS map to test the presence of the source 
          as Figure \ref{fig: j1939_tsmap_comparison_15} shows. 
          
          \begin{figure}[!ht]
            \centering 
            \includegraphics[scale=0.4]{/Users/grewwc/Desktop/Thesis/j1939_cur.png}
            \caption{}
            \label{fig: j1939_cur_with_data_points}
          \end{figure}
          
          \begin{figure}[!ht]
            \begin{minipage}{0.40\textwidth}
              \begin{center} 
                \includegraphics[scale=0.31]{/Users/grewwc/Desktop/Thesis/j1939_tsmap_nosource_15.png}
              \end{center}
            \end{minipage}
            \begin{minipage}{0.40\textwidth}
              \begin{center}
                \includegraphics[scale=0.31]{/Users/grewwc/Desktop/Thesis/j1939_tsmap_withsource_15.png}
              \end{center}
            \end{minipage}
            \caption{TS maps of PSR B1937+21. The dimension is $3^{\circ} \times 3^{\circ}$
              ($15$ pixels $\times 15$ pixels and each pixel is 
              $0.2^{\circ} \times 0.2^{\circ}$). The left panel is generated by the model 
              after removing PSR B1937+21 while the right panel contains the source.}
            \label{fig: j1939_tsmap_comparison_15}
          \end{figure}

          \begin{table}[!ht]
            \centering
              \scalebox{0.8}{
              \begin{tabular}{|c|c|c|c|c|}
                \cline{1-5}
                & \multicolumn{2}{|c|}{This Study} & \multicolumn{2}{|c|}{Previous Results} \\
                \cline{1-5}
                & Value & Error & Value & Error \\
                \hline
                Index1 ($\gamma_1$) & $2.78$ & $0.01$ & $2.38$ & $0.07$ \\
                \hline 
                Cutoff ($E_c$, MeV) & $3392.92$ & $108.36$ & $8000$ & $4000$ \\
                \hline 
                Energy Flux (erg $cm^{-2} s^{-1}$) ($10^{-12}$) & $19$ & $0.3$ & $16$ & $2$ \\ 
                \hline
              \end{tabular}}  
              \mycaption{Fit parameters of the spectral model of PSR B1937+21. 
                The names of parameters are consistent with Eq.
                \ref{eq: fermi_model}. The old results are from the paper \cite{0004-637X-787-2-167}.}
              \label{table: j1939_fit_result}        
          \end{table} 

    \chapter{Theory And Simulation}

      \section{A Brief Introduction to Outer Gap Model}
        It is oversimplified to regard a pulsar as a magnetized sphere rotating in vacuum. 
        Actually, there are plenty of charged particles in a pulsar's magnetosphere 
        which co-rotate with the pulsar. The creation of charged particles can 
        be described following steps \cite{Sturrock:1971zc}.

        The co-rotating charged primary particles emit gamma-ray by curvature 
        radiation because they are accelerated by environmental magnetic fields.  
        In intense magnetic field, the high energy photons decay into electrons and 
        positrons which are called secondary particles by the process: 
        $\gamma + (B) \rightarrow e^++e^-+(B)$ and these charged particles can emit 
        synchrotron radiations. The secondary particles in charge-deficient regions can also 
        be accelerated to very high speed by strong magnetic field just like primary particles 
        and some of them then emit gamma-rays which can further decay into electrons and 
        positrons. As a result, these charged particles can create more secondary particles.
        This chain of process is quite efficient to produce charged particles and 
        make a pulsar's magnetosphere filled with plasma as a consequence. Therefore, a 
        characteristic charge density $\rho_{GJ}=-\frac{\vec{\Omega}\cdot \vec{B}}{2\pi c}$ 
        called Goldreich-Julian charge density is produced \cite{1969ApJ}. By the definition 
        of $\rho_{GJ}$, there is a surface called null charge surface where $\rho_{GJ}$ is 
        very close or equal to $0$. 

        Since the charged particles cannot move along the magnetic field lines near 
        the light cylinder, there are closed field lines and open field lines. Charged 
        particles can move out of the magnetosphere along those open field lines. Thus, the 
        charge density in the regions nearly the light cylinder can be much smaller than 
        \gj{} and electrons and positrons are accelerated to very high speeds by electric 
        fields parallel to the magnetic field lines ($E_{\parallel}$). These regions are called 
        outer gap which are between the null charge surface and the light cylinder as Figure 
        \ref{fig: outer gap model} shows. \cite{1986ApJ...300..500C}

        % \begin{figure}
          % \centering 
          % \includegraphics[scale=0.35]{/Users/grewwc/Desktop/Thesis/}
        % \end{figure}

      
        As a result, the charged particles can be 
        accelerated to a very large velocity (Lorentz factor $\gamma\sim 10^7$) and then 
        emit gamma-ray. Photons in outer gap can also create electrons and positrons by 
        the process: $\gamma+\gamma\rightarrow e^-+e^+$. At the outer gap, the above process 
        can't happen because magnetic field is too weak in this region.


      \section{Two-layer Model}
        After we have reviewed gamma-ray emission mechanism, we can proceed to
        the two-layer model on which this thesis is mainly based \cite{0004-637X-720-1-178}. 
        Two-layer model is a variation of outer-gap model since they both claim that the 
        gamma-ray emission zone is close to the light cylinder. However, in the two-layer 
        model, the outer layer consists of two regions --- a primary acceleration region and 
        a screening region. 

        In the primary region, charged particles moved out of pulsars along the open field 
        lines, so the charge density is usually very low. 
        However, by pair-production processes, a lot of $e^{-}$ and $e^{+}$ are produced. 
        But in the primary region where lots of pairs are created, the charge density 
        doesn't change very much because the pairs have not been separated yet. With the help 
        of strong electric field, the particles of different signs move to opposite directions. 
        As a result, the two-layer model states that above the primary region, a screening 
        region will be created and the charge density is very large because of the accumulation 
        of the charged particles. This is basically the reason why there are two regions in 
        pulsars' outer magnetosphere.

        The next issue is that how to describe the distribution of charge density in these two 
        regions. For simplicity, the model just uses a step function to represent the charge 
        density distribution and a step function can clearly shows the gap between the two 
        regions. It uses a magnetic dipole model to approximate the 
        magnetic distribution in the magnetosphere. Since in magnetic dipole model, magnetic 
        fields at one position is only dependent on the position's distance from the source 
        and altitude, the model also ignores the azimuthal distribution of charge density 
        and uses two parameters which are distance $r$ and altitude $\theta$ to calculate the 
        magnetic field at a particular position.

        The two-layer model uses three parameters to express the structure of a pulsar's outer 
        magnetosphere --- charge density of the primary region, the total height of the primary 
        region and the screening region and the last one is the ratio of the thickness of the 
        primary region and the screening region. Figure \ref{fig: charge_density} shows the 
        basic structure of two-layer model. 

        \singleFig{charge_density}{0.6}{(a): Geometry of the two-layer model. $h_{1}$ and 
          $h_{2}$ is the height of the primary region and the screening region respectively. 
          (b): the charge densities of primary region and screening region. In the primary 
          region, the charge density is much smaller than Goldreich-Julian charge density
          while is larger in the screening region. The figure is from 
          \cite{0004-637X-720-1-178}.}

        As Figure \ref{fig: charge_density} shows, 
        let the charge density of the primary region be $\rho_1 = (1-g_{1}) \rho_{GJ}$ and 
        the total gap size be
        $h_{2}$, where $\rho_{GJ}$ is the Goldreich-Julian charge density. For convenience, 
        also denote the gap size of the primary region by $h_{1}$. 
        \myComment{Then we can calculate electric potential and electric field by solving the 
        Poisson equation }

        Denote the electrical potential with $\phi_{0}$ which satisfies 
        \begin{equation}
          \label{eq: Poisson_corotating}
          \nabla^{2}\phi_{0} = -4\pi\rho_{GJ}
        \end{equation}
        and the total electrical potential is $\phi = \phi_{0} + \phi^{\prime}$, 
        where $\phi^{\prime}$ is a representation of the deviation of the co-rotating 
        electrical potential. Let the total charge density be $\rho$ and subtract 
        Eq. \ref{eq: Poisson_corotating} we have,
        \begin{equation}
          \label{eq: Poisson_final}
          \nabla^{2}\phi^{\prime} = -4\pi\left(\rho - \rho_{GJ} \right)
        \end{equation}

      Because the model has ignored the distribution in the azimuthal direction, it uses two 
      parameters $x, z$ to represent a position, where $x$ is the direction along the magnetic 
      field line and $z$ is perpendicular to the magnetic field line. In order to solve 
      Eq. \ref{eq: Poisson_final}, the model also makes two approximations. The first is that 
      the derivative of electrical potential $\phi$ is ignored. The second is that the \gj{} 
      is uniformly distributed along the magnetic line direction ($x$ direction). These two 
      approximations are based on a reasonable assumption that the change rate 
      for both electrical potential ($\phi^{\prime}$) and \gj{}($\rho_{GJ}$) along the $x$ 
      direction is much smaller than $z$ direction. 
      As a result, Eq. \ref{eq: Poisson_final} can be written as: 
      \begin{equation}
        \label{eq: Poisson_final_final}
        \frac{\partial^2}{\partial z^2} \phi^{\prime} = -4\pi\left(\rho - \rho_{GJ} \right)
      \end{equation}

      In order to solve Eq. \ref{eq: Poisson_final_final}, proper boundary conditions are also 
      needed. First of all, we have to decide the boundary positions, which is determined by 
      four parameters and they can be written as $x_{lo}, x_{hi}, z_{lo}, z_{hi}$. It is 
      reasonable to set $x_{lo}$ and $x_{hi}$ be the pulsar's surface and the light cylinder 
      respectively and $z_{lo}$ (lower boundary) be the last open field line. And let the 
      electrical potential be $0$ along the last open field line (this is because the 
      variation of electric field in $x$ direction is ignored).   

      \begin{equation}
        \label{eq: lower_boundary}
        \phi \left(x, z_{lo}\right) = 0
      \end{equation}
      To know the position of $z_{hi}$ is a little bit tricky. In order to make the electrical 
      potential be continuous at $z = z_{hi} = h_2$, the model sets the 
      $\phi^{\prime}\left(z=h_{2}\right) = 0$ since the non-co-rotating electrical potential 
      outside the upper bound is $0$ and the co-rotating potential is continuous near the 
      boundary. Additionally, because $\phi^{\prime}\left(z=h_{2}-\right) = 0$
      and $\phi^{\prime}\left(z=h_{2}+\right) = 0$, it is known that the first derivative 
      $\partial{\phi^{\prime}}/\partial{z}\vert_{z=h_{2}}$ is $0$, which means 
      $E_{\perp}\vert_{z=h_{2}} = 0$. In order to solve Eq. \ref{eq: Poisson_final_final}, 
      denote charge densities of the two regions for convenience as the function 
      \ref{eq: twolayer_charge_density} shows.
      \begin{equation}
        \label{eq: twolayer_charge_density}
          \rho\left(z\right) = 
          \begin{cases}
             & \rho_{1} , \text{    if} \left(0 \leq z < h_{1}\right)\\
             & \rho_{2} , \text{    if} \left(h_{1} \leq z \leq h_{2}\right) 
          \end{cases}       
      \end{equation}
      With definition in Eq. \ref{eq: twolayer_charge_density} and the three boundary 
      conditions, the solution of Eq. \ref{eq: Poisson_final_final} is, 
      \begin{equation}
        \label{eq: twolayer_potential}
          \phi^{\prime}\left(z, x\right) = -2\pi
          \left\{\begin{alignedat}{2}
             & \left(\rho_{1} - \rho_{GJ}\left(x\right)\right)z^2 + C_{1} z ,  &&\left(0 \leq z < h_{1}\right)\\
             & \left(\rho_{2}-\rho_{GJ}\left(x\right)\right)\left(z^2 - h_2^2\right) + D_{1} \left(z-h_2\right),  &&\qquad \left(h_{1} \leq z \leq h_{2}\right) 
          \end{alignedat}\right.
      \end{equation}
      where 
      \begin{equation*}
        C_{1} = \frac{\left(\rho_{1}-\rho_{GJ}\left(x\right)\right)h_1\left(h_1-2h_2\right)-\left(\rho_2-\rho_{GJ}\left(x\right)\right)\left(h_1-h_2\right)^2}{h_2} 
      \end{equation*}
      and 
      \begin{equation*}
        D_{2} = \frac{\left(\rho_1-\rho_2\right)h_1^2-\left[\rho_2-\rho_{GJ}\left(x\right)\right]h_2^2}{h_2}
      \end{equation*}
      From Eq. \ref{eq: twolayer_potential} and apply 
      $\rho_{GJ}\left(x\right)=-\left(\Omega B x\right)/\left(2\pi cs\right)$ 
      we can directly derive the electrical field parallel to magnetic field lines as a 
      function of $z$ as Eq. \ref{eq: twolayer_field} shows.
      \begin{equation}
        \label{eq: twolayer_field}
          E^{\prime}_{\parallel}\left(z\right) = \frac{\Omega B}{cs}
          \left\{\begin{alignedat}{2}
             & -g_1 z^2 + C_1^{\prime}z ,  &&\left(0 \leq z < h_{1}\right) \\
             & g_2\left(z^2 - h_2^2\right) + D_1^{\prime}\left(z-h_2\right)  &&\qquad \left(h_{1} \leq z \leq h_{2}\right) 
          \end{alignedat}\right.
      \end{equation}
      where 
      \begin{equation*}
        C_{1}^{\prime} = \frac{g_1 h_1 \left(h_1 - 2h_2\right)+ g_2\left(h_1-h_2\right)^2}{h_2}  
      \end{equation*}
      and 
      \begin{equation*}
        D_{2}^{\prime} = -\frac{\left(g_1 + g_2\right)h_2^2 + g_2 h_2^2}{h_2}
      \end{equation*}

      Since charged particles are accelerated in the primary region to relativistic speeds 
      and then emit energy by curvature radiation, we have,
      \begin{equation}
        \label{eq: all_is_curvature_radiation}
        e E_{\parallel}^{\prime} c = l_{cur}
      \end{equation}
      where $E_\parallel^{\prime}$ is the electric field strength along the magnetic field 
      line described in Eq. \ref{eq: twolayer_field}.
      Lorentz factors of the charged particles is estimated according to Eq. 
      \ref{eq: curvature_radiation_power}.
      \begin{equation}
        \label{eq: curvature_radiation_power}
        l_{cur} = \frac{2 e^2 c \gamma^{4}_{e}}{3s^2}
      \end{equation}      
      where $s$ is the radius of curvature. 
      Combining Eq. \ref{eq: all_is_curvature_radiation} and Eq.
      \ref{eq: curvature_radiation_power} we get expression for Lorentz factor: 
      \begin{equation}
        \label{eq: gamma_can_be_zero}
        \gamma_{e} = \left(\frac{3s^2}{2e} E_{\parallel}^{\prime}\right)^{1/4}
      \end{equation}
      With Lorentz factor of charged particles known, we can derive curvature radiation 
      spectrum for single charged particle and then can get the total spectrum by integrating 
      over all charged particles. This is the simplified idea of the Two-layer model. 

      

      \section{Numerical Calculation of Spectra Based on Two-layer Model}
        After we have understood the theory part of the two-layer model, 
        we can then do numerical calculations of the spectra 
        based on the theory. Since the theory is the same for all the three MSPs, the calculation 
        algorithms are the same. 

        There are three independent parameters to fit altogether in the calculation. 
        The first parameter is fractional gap size $f=h_{2}/R_{lc}$, where $h_{2}$ is the 
        total gap size including both the primary acceleration region and the screening region 
        and $R_{lc}$ is the length of light cylinder. The second parameter is $g_{1}$ so that
        the charge density in the primary accelerating region is $\left(1-g_{1}\right) \rho_{GJ}$, 
        where $\rho_{GJ}$ is the Goldreich-Julian charge density. The third parameter is the ratio 
        between the sizes of the two gaps ($h_{1}/h_{2}$). Note that we only set the charge density in the primary acceleration region as an 
        independent parameter, since the charge density in the two gaps are related to each 
        other. Figure \ref{fig: j0218_twolayer_cur.png} is the spectra of the three MSPs generated
        from the two-layer model and the result of the fitting parameters are listed in Table 
        \ref{table: twolayer_fit_parameter}. Other than the low energy and high energy gamma-ray bands, 
        the model is consistent with the observation data in terms of gamma-ray part. 

        Generally speaking, the modeled spectra for the three MSPs are acceptable. Just as 
        we have discussed in the data analysis part that global fits are not very consistent 
        with separate fits in low energy gamma-ray band (about $100\mbox{MeV} - 1000\mbox{MeV}$) and high energy
        band (above $10 \mbox{GeV}$), the modeled spectra also have the same problem. 
        This can have two explanations. Firstly, the Fermi telescope is not sensitive below 
        about $100 \mbox{MeV}$. As a result, the observation data may not be very reliable at  
        this energy band. Secondly, the real emission mechanism in the energy band is different 
        from the model predicts. Thus, we can observe inconsistency between the calculations 
        and observations.
 
        \singleFig{j0218_twolayer_cur.png}{0.41}{The modeled spectrum of PSR J0218+4232.}
        \singleFig{b1821_twolayer_cur.png}{0.4}{The modeled spectrum of PSR B1821-24.}
        % \mayChange{I wanted to combine the three figures together, if I do so, each 
        %   figure is too small.}}
        \singleFig{j1939_twolayer_cur.png}{0.41}{The modeled spectrum of PSR B1937+21.}
        
        \begin{table}[!ht]
          \centering
          \scalebox{1.1}{
          \begin{tabular}{|c|c|c|c|}
            \hline 
            & f & g & $h_1/h_2$ \\ 
            \hline 
            PSR J0218+4232 & 0.330 & 0.92 & 0.915 \\
            \hline 
            PSR B1821-24 & 0.247 & 0.955 & 0.920 \\
            \hline 
            PSR B1937+21 & 0.320 & 0.975 & 0.925 \\
            \hline 
          \end{tabular}}
          \mycaption{The results of fitting parameters for the three MSPs. The physical 
            meaning of each parameter is consistent with the two-layer model describe above.}
            % \change{Table is ugly, but not sure how to make it more beautiful...}}
          \label{table: twolayer_fit_parameter}
        \end{table}
        \vspace{0.5cm}
          
        After obtaining the spectra fit results in gamma-ray band, we can generate broad band spectra 
        as Figure \ref{fig: j0218_twolayer_all.png} shows. 
        The hard X-ray data are from the paper \cite{0004-637X-845-2-159}. By tweaking the 
        independent parameters of the two-layer model, we can make the modeled spectra very 
        close to the observation data in hard X-ray band. Since we lack observation data in 
        the energy band from about $100$keV to $100$MeV, we cannot tell if the two-layer model 
        describes the right physical scenario in this energy range. However, the prediction made 
        by the simplified two-layer model is relatively precise. In addition, the model is very 
        intuitive, which is also a very important consideration for building a model. Just as 
        the famous words "With four parameters I can fit an elephant, and with five I 
        can make him wiggle his trunk" 
        said by John von Neumann, in principal, we can fit any data by adding independent parameters. 
        Therefore, in order to test if a theory model is good or not, not only we need to consider 
        how precisely the model can predict, but also the physical meaning behind the model. In this 
        sense, the two-layer model is a good start of explaining emission mechanism of 
        pulsars. 
          
        \singleFig{j0218_twolayer_all.png}{0.39}{The broad band and modeled spectrum of PSR J0218+4232.
          The grey shade is the error of the global fit. And the green shade in the left panel ef the 
          figure represents the error of hard X-ray. The 'Total' legend represents the total flux 
          combining the Synchrotron radiation, inverse Compton radiation and curvature radiation
          altogether.}
        \vspace{0.5cm} 
        
        \singleFig{b1821_twolayer_all.png}{0.4}{The broad band and modeled spectrum of PSR B1821-24.
          The meaning of grey shade and the green shade are the same as Figure \ref{fig: j0218_twolayer_all.png}}
        \vspace{0.5cm} 
          
        \singleFig{j1939_twolayer_all.png}{0.39}{The broad band and modeled spectrum of PSR B1937+21.
          The meaning of grey shade and the green shade are the same as Figure
          \ref{fig: j0218_twolayer_all.png}}
        \vspace{0.5cm}
        
      \section{Pitfalls and Considerations of Doing Numerical Calculation}
        \subsection{Correctness of Computation}
          To make sure the numerical computation be right is the most important. 
          The first consideration is underflow and overflow of floating digits.
          One possible condition is calculating speed of relativistic charged particles with 
          Lorentz factor $\gamma$. By doing some simple test, we find that for 
          $\gamma < 1.5\times 10^7$, the results are precise enough. However, there is significant rounding error
          when $\gamma > 5\times 10^7$, which means that our results will be wrong for highly 
          energetic particles if we directly use the formula $\beta = \sqrt{1 - 1/\gamma^2}$.
          Likely, in the two-layer model, nearly all particles have $\gamma < 1\times 10^7$. 
          Furthermore, there are nearly no situations where double precision floating digits
          cannot handle calculation results of the two-layer model. Thus, as long as we use 
          64-bit floating digits instead of 32-bit floating digits, we are free from overflowing and 
          underflow troubles. 
            
          There are some cases when a whole function can be calculated while some parts of them are not. 
          Take Function $f\left(x\right) = x\times1/x$ for example. When $x$ is too large, it 
          can not be expressed by a computer and multiplication is not associative when doing floating 
          point operation. We encounter some situations like this.
          The formula of curvature radiation spectrum contains modified Bessel function of order $5/3$.
          In order to speed up the program, we use a polynomial to express the Bessel function, as
          Eq. \ref{func: polynomial_appro} shows. 
          \begin{equation}
            K_{5/3} \left(x\right) \simeq a \left(\frac{1}{x} + b\right)^{-cx - 1/3} \sqrt{\frac{\pi}{2}} e^{-x - d} \sqrt{x + d} %
            \left[1 + \frac{55}{72\left(x + d\right)} - \frac{10151}{10368}\left(x+d\right)^2\right] 
            \label{func: polynomial_appro}
          \end{equation}
          where $a,b,c,d$ are just positive constants and $c = 0.96 < 1$. As a result, 
          the part $(1/x + b)^{-cx - 1/3}$ in Function \ref{func: polynomial_appro} is infinity
          when $x$ is large though the total function is approximated to $0$. Thus, we have to explicitly 
          assign the result to be $0$ instead of calculating it. Actually, this error is not easy to find 
          since in most cases the result is not infinity. 
          
        \subsection{Speed of Computation}
          We actually have not done any accurate benchmarks for the following discussions and they are 
          dependent of the average time of running the simulation.
          The most obvious solution of to use multicores to do computation. However, most library functions 
          do not support run concurrently and only run on a single core. For example, we need to do many 
          integrations and the speed of integration is critical. We write some simple functions to 
          utilize four CPU cores at the same time when doing integration. 
          This gives us a huge performance improvement.

          Furthermore, There are some facts about the basic operations. For instance, add is faster than 
          multiplication which is faster than devision. Multiplications and devisions are not associative
          between floating points. 
          Though the performance differences between different operations for integers can usually be 
          optimized 
          away by modern compilers, the compilers can do nothing for floating points. Thus, we have to do 
          it 
          by ourselves. For example, we have $z^2 - h_2\left(x\right)^2$ in function 
          \ref{eq: twolayer_field}.
          In this formula, we have two multiplications and one subtraction. After we re-write it to 
          $\left(z-h_2\right)\left(z + h_2\right)$, we have one addition, one subtraction and one 
          multiplication.
          Since addition and subtraction is not slower than multiplication, it has no performance harm 
          for the rewriting. What we need to notice is that the multiplication may not be slower than 
          addition
          and it is dependent on machines. However, division is definitely slower than the other three operations. 
          Therefore, in our program, expressions like $1 / 3$ are rewritten to $1*0.3333$ and so on.  
  %stupid

    \chapter{Discussion and Future Work}
      
        
      \subsection{Constraints of The Two-lay Model Used In The Thesis} 
        The simplified two-layer model is consistent with observation data to some extent. 
        (The relevant data can be found in the paper \cite{0004-637X-720-1-178})
        The model uses four parameters to get a fairly good prediction of the gamma-ray 
        spectra of many pulsars. And all these four parameters have very obvious physical 
        meanings. However, the problems of the model is clear --- it is somewhat 
        oversimplified. Although there are other more sophisticated versions of the 
        two-layer model such as three-dimensional two-layer model 
        \cite{doi:10.1111/j.1365-2966.2011.18577.x} and I used the simpler one, which may cause 
        some inconsistencies between the simulations and observations. 

        Therefore, we can briefly analyze which part is oversimplified and can be improved. 
        First of all, we directly use a step function to describe the charged particle 
        distribution. Though the charge density of the screening region is much larger than 
        the primary region, using a step function is not very physical and may exaggerate 
        the change rate of charge density. At the same time, the dramatic change of charge 
        density also brings some numerical instabilities.

        Secondly, the model sets the total of screening region and primary region to be 
        rectangular shape. Though the actual shape is not clear, it should not be a 
        rectangular in theory and may be very different. In numerical simulation, changes 
        in shape of the regions will directly lead to a different integration region, 
        which may change the simulated spectra.

        Thirdly, there are some inconsistencies in the model itself according to the its 
        assumptions. According to Eq. \ref{eq: curvature_radiation_power} and Eq. 
        \ref{eq: gamma_can_be_zero}, since $E_{\parallel}^{\prime}$ can be $0$, we know that 
        $\gamma_{e}$ can also be $0$, which is absolutely non-physical. Although this may not 
        have large influences on the spectra, it is the problem that should be avoided.

        All in all, the model is simple and the gamma-ray spectra computed based on the model 
        is consistent with observation data. There are many much more sophisticated 
        two-layer model which are generalizations of model used in the thesis. Those models 
        may have addressed the problems described above, but the model used in the thesis 
        do have some defects. 


        

% \begin{thebibliography}{9}


% \end{thebibliography}
\bibliographystyle{plain}
\bibliography{bibfile}
          

\end{document}





